---
layout: blogs_default
title: 产品性能自测
subtitle: 对kairosdb写入、读出性能的测试
date: 2017-12-10 22:08:41
categories:
- 数据库
tags:
    - kairosdb
    - cassandra
    - jmeter

---

*本文是从公司内网KB转过来的，格式有点混乱懒得改了QAZ~~

 **目录 (Table of Contents)**
------------------------------------------------

+ FAQ
+ 一、测试目的
+ 二、测试环境
+ 三、测试方法
+ 四、测试结果
    + 写:
    + 读：
+ 五、结论
    + 1、指标库写性能：
    + 2、指标库读性能：

<h2 id="id-指标库性能测试-FAQ">FAQ</h2>
<p><strong>1.写入能力：多少个15秒监控周期的主机，或180秒监控周期的网络设备的数据写入</strong></p>
<p style="margin-left: 30.0px;">假设现场1个资源每15 S上报100个指标，则每分钟上报400个，</p>
<p style="margin-left: 30.0px;">若部署单节点Cassandra，在redis集群状况良好的情况下，每分钟可写入80W个指标，可支持800000/400=2000个资源左右;</p>
<p style="margin-left: 30.0px;">若部署Cassandra 集群，每分钟可写入110W个指标，可支持1100000/400=2750个资源左右;</p>
<p style="margin-left: 30.0px;">考虑到稳定性可酌情减少资源量或增加配置。</p>
<p><strong>2.读出能力：每秒完成指定数据点数查询的TPS性能峰值，以便预测可以支持什么数量的仪表盘</strong></p>
<p style="margin-left: 30.0px;">在三台4C*16G的Cassandra节点的配置下，稳定查询的前提下，每分钟至少400条并发请求（每条请求至少6000条元数据，大约为15分钟的数据）。</p>
<p style="margin-left: 30.0px;"></p>
<p></p>
<p></p>
<p></p>
<h2 id="id-指标库性能测试-一、测试目的">一、测试目的</h2>
<p>测试在指定硬件条件下，指标库写入能力与读取能力。</p>
<h2 id="id-指标库性能测试-二、测试环境">二、测试环境</h2>
<div class="table-wrap">
    <table class="confluenceTable">
        <tbody>
        <tr>
            <th class="confluenceTh">ip</th>
            <th colspan="1" class="confluenceTh">cpu</th>
            <th class="confluenceTh">内存</th>
            <th colspan="1" class="confluenceTh">磁盘</th>
            <th colspan="1" class="confluenceTh">用途</th>
            <th colspan="1" class="confluenceTh">备注</th>
        </tr>
        <tr>
            <td colspan="1" class="confluenceTd">个人电脑</td>
            <td colspan="1" class="confluenceTd">4核</td>
            <td colspan="1" class="confluenceTd">16G</td>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd"><span>部署jmeter</span></td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <td colspan="1" class="confluenceTd"><span>10.1.53.37</span></td>
            <td colspan="1" class="confluenceTd">6<span>核</span></td>
            <td colspan="1" class="confluenceTd">8G</td>
            <td colspan="1" class="confluenceTd"></td>
            <td rowspan="4" class="confluenceTd">部署jmeter-server</td>
            <td rowspan="4" class="confluenceTd"><p><span>通过jmeter来发送测试请求，</span></p>
                <p>这些机器同时部署着其他产品。<br/><br/></p></td>
        </tr>
        <tr>
            <td colspan="1" class="confluenceTd"><span>10.1.53.38</span></td>
            <td colspan="1" class="confluenceTd"><span>4核</span></td>
            <td colspan="1" class="confluenceTd">16G</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <td colspan="1" class="confluenceTd"><span>10.1.53.65</span></td>
            <td colspan="1" class="confluenceTd"><span>4核</span></td>
            <td colspan="1" class="confluenceTd"><span>8G</span></td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <td colspan="1" class="confluenceTd"><span>10.1.61.10</span></td>
            <td colspan="1" class="confluenceTd"><span>4核</span></td>
            <td colspan="1" class="confluenceTd">24G</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <td colspan="1" class="confluenceTd">10.1.53.39</td>
            <td colspan="1" class="confluenceTd"><span>4核</span></td>
            <td colspan="1" class="confluenceTd">16G</td>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">指标库、ES、租户等组件</td>
            <td colspan="1" class="confluenceTd">该机器主要用来部署指标库</td>
        </tr>
        <tr>
            <td class="confluenceTd">10.1.61.117</td>
            <td colspan="1" class="confluenceTd">4核</td>
            <td class="confluenceTd">16G</td>
            <td colspan="1" class="confluenceTd">38G</td>
            <td colspan="1" class="confluenceTd">kairosdb、omp等</td>
            <td colspan="1" class="confluenceTd"><span>kairosdb 堆内存为默认的3g</span></td>
        </tr>
        <tr>
            <td class="confluenceTd">10.1.61.118</td>
            <td colspan="1" class="confluenceTd">4核</td>
            <td class="confluenceTd">16G</td>
            <td colspan="1" class="confluenceTd">38G</td>
            <td colspan="1" class="confluenceTd">Cassandra</td>
            <td colspan="1" class="confluenceTd"><p><span>kairosdb 堆内存为<span>为默认的4</span>g，</span></p>
                <p>计算公式 max(min(1/2 ram, 1024MB),min(1/4 ram, 8GB))</p></td>
        </tr>
        </tbody>
    </table>
</div>
<p></p>
<h2 id="id-指标库性能测试-三、测试方法">三、测试方法</h2>
<p>测试工具为Jmeter，通过调用指标库相应的openApi测试，用jconsole 监控进程占用资源变化。</p>
<h2 id="id-指标库性能测试-四、测试结果">四、测试结果</h2><h4 id="id-指标库性能测试-写:">写:</h4>
<p style="margin-left: 30.0px;"><span>Ramp-up Period <span>决定多长时间启动所有线程。如果使用10个线程，ramp-up period是100秒，那么JMeter用100秒使所有10个线程启动并运行。每个线程会在上一个线程启动后10秒（100/10）启动。</span></span>
</p>
<p style="margin-left: 30.0px;">monitor 指标上报的频率是15S一次，故此处从 以15S/s 的频率启动一个上报线程开始测试。</p>
<p style="margin-left: 30.0px;">如组1，测试逻辑为：</p>
<p style="margin-left: 60.0px;">每15秒启动一个线程，单个线程每次上报25个指标，重复上报500次，每分钟指标写入请求次数为5W条。</p>
<p style="margin-left: 60.0px;">jmeter-server为1，表示只在本机运行测试；若为4，表示在4个机器上同时对指标库发起请求测试。</p>
<p style="margin-left: 30.0px;"></p>
<div class="table-wrap">
    <table class="confluenceTable">
        <tbody>
        <tr>
            <th rowspan="2" class="confluenceTh">组别</th>
            <th colspan="6" style="text-align: center;" class="confluenceTh">条件</th>
            <th colspan="8" style="text-align: center;" class="confluenceTh">jmeter 运行结果</th>
            <th colspan="2" class="confluenceTh">指标库 统计日志</th>
            <th colspan="2" class="confluenceTh">kairosdb 资源消耗</th>
            <th colspan="2" class="confluenceTh"><span>Cassandra资源消耗</span><span> </span></th>
            <th rowspan="2" style="text-align: center;" class="confluenceTh">备注</th>
        </tr>
        <tr>
            <th class="confluenceTh">线程数（单个<span style="color: rgb(0,0,0);">jmeter-server</span>）</th>
            <th class="confluenceTh">Ramp-up Period（in seconds）</th>
            <th colspan="1" class="confluenceTh"><span>指标数</span></th>
            <th class="confluenceTh">循环次数</th>
            <th colspan="1" class="confluenceTh"><span>jmeter-server</span></th>
            <th colspan="1" class="confluenceTh">每分钟请求次数（W）</th>
            <th colspan="1" class="confluenceTh">samples(W)</th>
            <th class="confluenceTh">avg(ms)</th>
            <th colspan="1" class="confluenceTh">p90(ms)</th>
            <th colspan="1" class="confluenceTh">p95(ms)</th>
            <th class="confluenceTh">min(ms)</th>
            <th class="confluenceTh">max(ms)</th>
            <th colspan="1" class="confluenceTh">Error (%)</th>
            <th class="confluenceTh">throughput<br/> （吞吐量,sec）</th>
            <th colspan="1" class="confluenceTh"><span>每分钟</span><span>最大可</span><span>写入数据量</span></th>
            <th colspan="1" class="confluenceTh">avg(ms)</th>
            <th class="confluenceTh">cpu(%,单个)</th>
            <th class="confluenceTh">堆内存</th>
            <th class="confluenceTh">cpu(%,单个)</th>
            <th class="confluenceTh">堆内存</th>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">1</th>
            <td colspan="1" class="confluenceTd">40</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd"><span>50</span></td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">212</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">810.0905</td>
            <th colspan="1" class="confluenceTh"><span>50608</span></th>
            <td colspan="1" class="confluenceTd">0.03</td>
            <td colspan="1" class="confluenceTd"><span>2.2</span></td>
            <td colspan="1" class="confluenceTd">501.2m</td>
            <td colspan="1" class="confluenceTd">1.0</td>
            <td colspan="1" class="confluenceTd">801.5m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">2</th>
            <td colspan="1" class="confluenceTd">40</td>
            <td colspan="1" class="confluenceTd"><span>600</span></td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">2500</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd"><span>250</span></td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1207</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">3363.239</td>
            <th colspan="1" class="confluenceTh">256582</th>
            <td colspan="1" class="confluenceTd">0.03</td>
            <td colspan="1" class="confluenceTd">11.0</td>
            <td colspan="1" class="confluenceTd">817.6m</td>
            <td colspan="1" class="confluenceTd">6.0</td>
            <td colspan="1" class="confluenceTd"><span>979.3m</span></td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">3</th>
            <td colspan="1" class="confluenceTd">40</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">5000</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd"><span>50</span></td>
            <td colspan="1" class="confluenceTd"><span>500</span></td>
            <td colspan="1" class="confluenceTd">3</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">7</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1208</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">4958.901</td>
            <th colspan="1" class="confluenceTh">403887</th>
            <td colspan="1" class="confluenceTd">0.04</td>
            <td colspan="1" class="confluenceTd">16.7</td>
            <td colspan="1" class="confluenceTd">981.3m</td>
            <td colspan="1" class="confluenceTd">8.5</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">4</th>
            <td colspan="1" class="confluenceTd">40</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">7500</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">75</td>
            <td colspan="1" class="confluenceTd">750</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">6</td>
            <td colspan="1" class="confluenceTd">7</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">228</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">5591.89</td>
            <th colspan="1" class="confluenceTh">438234</th>
            <td colspan="1" class="confluenceTd">0.06</td>
            <td colspan="1" class="confluenceTd">15.3</td>
            <td colspan="1" class="confluenceTd">1.5g</td>
            <td colspan="1" class="confluenceTd">7.2</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">5</th>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">10000</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">50</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">207</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">3828.079</td>
            <th colspan="1" class="confluenceTh">346690</th>
            <td colspan="1" class="confluenceTd">0.04</td>
            <td colspan="1" class="confluenceTd">13.3</td>
            <td colspan="1" class="confluenceTd">1.6g</td>
            <td colspan="1" class="confluenceTd">7.2</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">6</th>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">50</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">6</td>
            <td colspan="1" class="confluenceTd">9</td>
            <td colspan="1" class="confluenceTd">11</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">408</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">7547.614</td>
            <th colspan="1" class="confluenceTh">493742</th>
            <td colspan="1" class="confluenceTd">0.09</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">9.8</td>
            <td colspan="1" class="confluenceTd">1.9g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">7</th>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">700</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">70</td>
            <td colspan="1" class="confluenceTd">700</td>
            <td colspan="1" class="confluenceTd">17</td>
            <td colspan="1" class="confluenceTd">28</td>
            <td colspan="1" class="confluenceTd">32</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">309</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">7995.924</td>
            <th colspan="1" class="confluenceTh">518429</th>
            <td colspan="1" class="confluenceTd">0.54</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">11.7</td>
            <td colspan="1" class="confluenceTd">2.1g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">8</th>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">125</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">50</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">10</td>
            <td colspan="1" class="confluenceTd">16</td>
            <td colspan="1" class="confluenceTd">18</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1019</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">8022.193</td>
            <th colspan="1" class="confluenceTh">497440</th>
            <td colspan="1" class="confluenceTd">0.26</td>
            <td colspan="1" class="confluenceTd">16.1</td>
            <td colspan="1" class="confluenceTd">1.6g</td>
            <td colspan="1" class="confluenceTd">10.2</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">9</th>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">1000</td>
            <td colspan="1" class="confluenceTd">97</td>
            <td colspan="1" class="confluenceTd">152</td>
            <td colspan="1" class="confluenceTd">161</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">7627</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">8216.643</td>
            <th colspan="1" class="confluenceTh">530591</th>
            <td colspan="1" class="confluenceTd">0.72</td>
            <td colspan="1" class="confluenceTd">20.1</td>
            <td colspan="1" class="confluenceTd"><span>2.0g</span></td>
            <td colspan="1" class="confluenceTd">20.4</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">10</th>
            <td colspan="1" class="confluenceTd"><span>800</span></td>
            <td colspan="1" class="confluenceTd"><span>600</span></td>
            <td colspan="1" class="confluenceTd"><span>25</span></td>
            <td colspan="1" class="confluenceTd"><span>125</span></td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">1000</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">161</td>
            <td colspan="1" class="confluenceTd">171</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1177</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">7972.218</td>
            <th colspan="1" class="confluenceTh">529113</th>
            <td colspan="1" class="confluenceTd">0.70</td>
            <td colspan="1" class="confluenceTd">21.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">10.8</td>
            <td colspan="1" class="confluenceTd">2.2g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">11</th>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">1000</td>
            <td colspan="1" class="confluenceTd">49</td>
            <td colspan="1" class="confluenceTd">76</td>
            <td colspan="1" class="confluenceTd">82</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1095</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">8219.331</td>
            <th colspan="1" class="confluenceTh">516068</th>
            <td colspan="1" class="confluenceTd">0.74</td>
            <td colspan="1" class="confluenceTd">21.5</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">10.5</td>
            <td colspan="1" class="confluenceTd">2.2g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">12</th>
            <td colspan="1" class="confluenceTd"><span>400</span></td>
            <td colspan="1" class="confluenceTd"><span>600</span></td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">1000</td>
            <td colspan="1" class="confluenceTd">98</td>
            <td colspan="1" class="confluenceTd">150</td>
            <td colspan="1" class="confluenceTd">159</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1188</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">8235.625</td>
            <th colspan="1" class="confluenceTh">504438</th>
            <td colspan="1" class="confluenceTd">0.78</td>
            <td colspan="1" class="confluenceTd">22.6</td>
            <td colspan="1" class="confluenceTd">2.1g</td>
            <td colspan="1" class="confluenceTd">23.8</td>
            <td colspan="1" class="confluenceTd">2.3g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">13</th>
            <td colspan="1" class="confluenceTd"><span>2400</span></td>
            <td colspan="1" class="confluenceTd">3600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">3870</td>
            <td colspan="1" class="confluenceTd">204</td>
            <td colspan="1" class="confluenceTd">268</td>
            <td colspan="1" class="confluenceTd">286</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">7723</td>
            <td colspan="1" class="confluenceTd">2.55%</td>
            <td colspan="1" class="confluenceTd">8890.767</td>
            <th colspan="1" class="confluenceTh">545621</th>
            <td colspan="1" class="confluenceTd">0.76</td>
            <td colspan="1" class="confluenceTd">23.1</td>
            <td colspan="1" class="confluenceTd">2.1g</td>
            <td colspan="1" class="confluenceTd">20.5</td>
            <td colspan="1" class="confluenceTd">2.5g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">14</th>
            <td colspan="1" class="confluenceTd"><span>120</span></td>
            <td colspan="1" class="confluenceTd"><span>600</span></td>
            <td colspan="1" class="confluenceTd"><span>25</span></td>
            <td colspan="1" class="confluenceTd">800</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd"><span><span>96</span></span></td>
            <td colspan="1" class="confluenceTd">960</td>
            <td colspan="1" class="confluenceTd">27</td>
            <td colspan="1" class="confluenceTd">44</td>
            <td colspan="1" class="confluenceTd">49</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1052</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">8504.614</td>
            <th colspan="1" class="confluenceTh">493434</th>
            <td colspan="1" class="confluenceTd">0.77</td>
            <td colspan="1" class="confluenceTd">20.1</td>
            <td colspan="1" class="confluenceTd">1.1g</td>
            <td colspan="1" class="confluenceTd">12.2</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">15</th>
            <td colspan="1" class="confluenceTd">720</td>
            <td colspan="1" class="confluenceTd">3600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">800</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd"><span>960</span></td>
            <td colspan="1" class="confluenceTd">5730</td>
            <td colspan="1" class="confluenceTd">146</td>
            <td colspan="1" class="confluenceTd">230</td>
            <td colspan="1" class="confluenceTd">242</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">3087</td>
            <td colspan="1" class="confluenceTd">0.02%</td>
            <td colspan="1" class="confluenceTd">8765.976</td>
            <th colspan="1" class="confluenceTh">556782</th>
            <td colspan="1" class="confluenceTd">0.71</td>
            <td colspan="1" class="confluenceTd">22.5</td>
            <td colspan="1" class="confluenceTd">1.6g</td>
            <td colspan="1" class="confluenceTd">25.1</td>
            <td colspan="1" class="confluenceTd">2.5g</td>
            <td colspan="1" class="confluenceTd">注：【1】</td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">16</th>
            <td class="confluenceTd">9600</td>
            <td class="confluenceTd">14400</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">5289</td>
            <td colspan="1" class="confluenceTd">15751</td>
            <td colspan="1" class="confluenceTd">127216</td>
            <td colspan="1" class="confluenceTd">127232</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">306493</td>
            <td colspan="1" class="confluenceTd">11.61%</td>
            <td colspan="1" class="confluenceTd">999.4154</td>
            <th colspan="1" class="confluenceTh">533848</th>
            <td colspan="1" class="confluenceTd">0.65</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd"><p>2.0g</p></td>
            <td colspan="1" class="confluenceTd"><span>注：【2】</span></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">17</th>
            <td colspan="1" class="confluenceTd">1200</td>
            <td colspan="1" class="confluenceTd">3600</td>
            <td colspan="1" class="confluenceTd">25</td>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">50</td>
            <td colspan="1" class="confluenceTd">3000</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">54</td>
            <td colspan="1" class="confluenceTd">61</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">1068</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">8180.800</td>
            <th colspan="1" class="confluenceTh">517877</th>
            <td colspan="1" class="confluenceTd">0.77</td>
            <td colspan="1" class="confluenceTd"><span>20.0</span></td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd"><p>2.0g</p></td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">18</th>
            <td colspan="1" class="confluenceTd">2880</td>
            <td colspan="1" class="confluenceTd">14400</td>
            <td colspan="1" class="confluenceTd">50</td>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">3600</td>
            <td colspan="1" class="confluenceTd">9</td>
            <td colspan="1" class="confluenceTd">17</td>
            <td colspan="1" class="confluenceTd">23<br/>
                <p></p></td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">3010</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd"><p><span>9822.518</span></p></td>
            <th colspan="1" class="confluenceTh">612078</th>
            <td colspan="1" class="confluenceTd">26.91</td>
            <td colspan="1" class="confluenceTd">15.0</td>
            <td colspan="1" class="confluenceTd">1.8g</td>
            <td colspan="1" class="confluenceTd">32.0</td>
            <td colspan="1" class="confluenceTd">2.5g</td>
            <td colspan="1" class="confluenceTd">多gateway 模块、</td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">19</th>
            <td colspan="1" class="confluenceTd">240</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">50</td>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">12000000</td>
            <td colspan="1" class="confluenceTd">15</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">39</td>
            <td colspan="1" class="confluenceTd">0</td>
            <td colspan="1" class="confluenceTd">3029</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">15974.696</td>
            <th colspan="1" class="confluenceTh">1109678</th>
            <td colspan="1" class="confluenceTd">15.70</td>
            <td colspan="1" class="confluenceTd">22.0</td>
            <td colspan="1" class="confluenceTd">0.8g</td>
            <td colspan="1" class="confluenceTd">13.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd">多指标库、Cassandra集群</td>
        </tr>
        </tbody>
    </table>
</div>
<p></p>
<p></p>
<p style="margin-left: 30.0px;">1.kairosdb 自带写入统计指标：</p>
<p style="margin-left: 60.0px;">kairosdb.metric_counters - Counts the number of data points received since the last
    report. Tags are used to separate one metric from another.（统计自上次上报后接收的数据量。标签用于区分指标。）</p>
<p style="margin-left: 60.0px;"></p>
<p style="margin-left: 30.0px;">kairosdb 统计结果：</p>
<p style="margin-left: 30.0px;">
{% asset_img  kairosdb_metric_count.png %}

</p>
<p style="margin-left: 30.0px;">“1”处为组别12的测试结果，“2”处为直接调用kairosdb restApi 写入接口，“3”处为组别14 的结果。结果与指标库的统计日志一致。

<p style="margin-left: 30.0px;">2.时间有限，每组测试时间间隔较短，因此可能会对CPU、内存以及Cassandra状态产生影响，使结果不够准确。</p>
<p style="margin-left: 30.0px;"></p>
<p style="margin-left: 30.0px;"><strong>注：</strong></p>
<p style="margin-left: 30.0px;">【1】：指标库redis 报内存不够，异常： Can't save in background: fork: Cannot allocate memory</p>
<p style="margin-left: 30.0px;">【2】：<span style="background-color: transparent;">短时间插入大量指标会导致未压实的sstable数据太多，压实进程报可用磁盘空间不足，重新压实...恶性循环。</span>
</p>
<p style="margin-left: 30.0px;"><span style="background-color: transparent;"><br/></span></p>
<div class="code panel pdl" style="border-width: 1px;">
    <div class="codeContent panelContent pdl">
    
```
<![CDATA[[root@localhost data_points-1e09be40c3c811e7977aa147ea7baf03]# /opt/cassandra/bin/nodetool compactionstats -H
pending tasks: 2
- kairosdb.data_points: 2
id                                   compaction type keyspace table       completed total    unit  progress
ef340e00-d4d8-11e7-a239-0d717928a22e Compaction      kairosdb data_points 6.23 GB   11.42 GB bytes 54.56%
Active compaction remaining time :   0h05m32s
]]>
```

    </div>
</div>
<p style="margin-left: 30.0px;"><span><br/></span></p>
<p style="margin-left: 30.0px;"><span>Cassandra报异常:</span></p>
<div class="code panel pdl" style="border-width: 1px;">
    <div class="codeContent panelContent pdl">
    
```
<![CDATA[WARN  [CompactionExecutor:46] 2017-11-28 22:26:29,785 CompactionTask.java:91 - insufficient space to compact all requested files BigTableReader(path=&#39;/opt/dbdata/cassandra/data/kairosdb/data_points-1e09be40c3c811e7977aa147ea7baf03/ma-216-big-Data.db&#39;), BigTableReader(path=&#39;/opt/dbdata/cassandra/data/kairosdb/data_points-1e09be40c3c811e7977aa147ea7baf03/ma-237-big-Data.db&#39;)
ERROR [CompactionExecutor:46] 2017-11-28 22:26:29,827 CassandraDaemon.java:195 - Exception in thread Thread[CompactionExecutor:46,1,main]
java.lang.RuntimeException: Not enough space for compaction, estimated sstables = 1, expected write size = 2395303467
	at org.apache.cassandra.db.compaction.CompactionTask.checkAvailableDiskSpace(CompactionTask.java:278) ~[apache-cassandra-3.5.jar:3.5]
	at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:126) ~[apache-cassandra-3.5.jar:3.5]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[apache-cassandra-3.5.jar:3.5]
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:82) ~[apache-cassandra-3.5.jar:3.5]
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:60) ~[apache-cassandra-3.5.jar:3.5]
	at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionCandidate.run(CompactionManager.java:264) ~[apache-cassandra-3.5.jar:3.5]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_144]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_144]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[na:1.8.0_144]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [na:1.8.0_144]
	at java.lang.Thread.run(Thread.java:748) [na:1.8.0_144]

]]>
```

    </div>
</div>
<p></p>
<p style="margin-left: 30.0px;">解决方法：</p>
<p style="margin-left: 60.0px;">1、增大磁盘空间、</p>
<p style="margin-left: 60.0px;">2、直接删除同一编号的sstable 大文件</p>
<p style="margin-left: 60.0px;">3、重装Cassandra</p><h4 id="id-指标库性能测试-多节点写:">多节点写:</h4>
<p style="margin-left: 30.0px;">1.通过观察发现，写的瓶颈在指标库的gateway，然后增加多节点的测试如下：</p>
<ul>
    <li style="margin-left: 30.0px;">开启一个gateway、一个writer模块后，指标写入能力在 <strong>50W/分钟</strong>；</li>
    <li style="margin-left: 30.0px;">开启三个gateway、一个writer模块后，指标写入能力在 <strong>80W/分钟</strong>；</li>
    <li style="margin-left: 30.0px;">开启三个三个gateway、三个writer 模块后，指标写入能力在 <strong>85W/分钟</strong>。</li>
</ul>

<p>
{% asset_img  kairosdb_metric_count_70W_75W.png %}

<p style="margin-left: 30.0px;">2.当部署Cassandra集群（3个节点）后，指标写入能力可以再次提升，<span style="background-color: transparent;">开启三个gateway、一个writer模块，指标写入能力在 <strong>100W/分钟</strong> ，此状态下可持续写入四个小时，期间redis会报内存不够的异常。</span>
</p>

<p style="margin-left: 30.0px; >
{% asset_img metric_count100W .png %}

</p>

<p style="margin-left: 30.0px;"><span style="background-color: transparent;">另外，当指标库写入在满载的情况下，指标的读取能力会受到很大影响，且写入也会偶尔报连接超时现象。</span>
</p>
<p style="margin-left: 30.0px;"><span style="background-color: transparent;"><br/></span></p><h4 id="id-指标库性能测试-读：">
    读：</h4>
<p>指标的查询，其实是kairosdb去查Cassandra中数据。因此kairosdb查Cassandra的速度才是关键因素。而查Cassandra数据的速度，跟查询的Cassandra的row数量、元数据量等因素相关。</p>
<p>要模拟读取测试，就需要先调查现场实际查询的row和元数据大小。</p>
<p>统计局的统计如下：</p>
<p style="margin-left: 30.0px;">上图为密集查询30分钟内指标时，从Cassandra中查询的row的行数；</p>
<p style="margin-left: 30.0px;">中图为密集查询30分钟内指标时，从Cassandra中查询的元数据的数量；</p>
<p style="margin-left: 30.0px;">下图为定时查询时row的行数。</p>
<p>

</p>
<p style="margin-left: 30.0px;">
{% asset_img  统计局_query_row_count2.png %}

</p>
<p style="margin-left: 30.0px;"></p>
<p style="margin-left: 30.0px;">
{% asset_img  统计局_query_sample_size.png %}

</p>
<p style="margin-left: 30.0px;"></p>
<p style="margin-left: 30.0px;">
{% asset_img  统计局_query_row_count.png %}

</p>
<p style="margin-left: 30.0px;"></p>
<p style="margin-left: 30.0px;"></p>
<p style="margin-left: 30.0px;">可以看出：</p>
<p style="margin-left: 30.0px;">密集查询时，row最大的在4000，大部分比较小，接近1。定时查询时，row在100行以下。</p>
<p style="margin-left: 30.0px;">现场400个设备，查询30分钟指标时，理论上应该有大约400*4*30=48000 的元数据，实际查询时，要小于该值。基本都在几百条。</p>
<p></p>
<p></p>
<div class="table-wrap">
    <table class="confluenceTable">
        <tbody>
        <tr>
            <th rowspan="2" class="confluenceTh">组别</th>
            <th colspan="9" style="text-align: center;" class="confluenceTh">条件</th>
            <th colspan="8" style="text-align: center;" class="confluenceTh">jmeter 运行结果</th>
            <th colspan="3" style="text-align: center;" class="confluenceTh">kairosdb 统计指标</th>
            <th colspan="2" class="confluenceTh">kairosdb 资源消耗</th>
            <th colspan="2" class="confluenceTh">Cassandra资源消耗</th>
            <th rowspan="2" style="text-align: center;" class="confluenceTh">备注</th>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">额外条件</th>
            <th class="confluenceTh">线程数（单个<span>jmeter-server</span>）</th>
            <th class="confluenceTh">Ramp-up Period（in seconds）</th>
            <th colspan="1" class="confluenceTh">指标数</th>
            <th class="confluenceTh">循环次数</th>
            <th colspan="1" class="confluenceTh">时间跨度（minute）</th>
            <th colspan="1" class="confluenceTh">kairosdb httpClient max connection（R12为2）</th>
            <th colspan="1" class="confluenceTh"><p>kairosdb concurrent</p>
                <p>QueryThreads<span style="color: rgb(0,0,0);">（默认为5）</span></p></th>
            <th colspan="1" class="confluenceTh">每分钟请求次数（个）</th>
            <th colspan="1" class="confluenceTh">samples(W)</th>
            <th class="confluenceTh">avg(ms)</th>
            <th colspan="1" class="confluenceTh">p90(ms)</th>
            <th colspan="1" class="confluenceTh">p95(ms)</th>
            <th class="confluenceTh">min(ms)</th>
            <th class="confluenceTh">max(ms)</th>
            <th colspan="1" class="confluenceTh">Error (%)</th>
            <th class="confluenceTh">throughput<br/> （吞吐量,sec）</th>
            <th colspan="1" class="confluenceTh"><span style="color: rgb(0,0,0);">query_row_count</span></th>
            <th colspan="1" class="confluenceTh">query_sample_size</th>
            <th colspan="1" class="confluenceTh">http.query_time(ms)</th>
            <th class="confluenceTh">cpu(%,单个)</th>
            <th class="confluenceTh">堆内存</th>
            <th class="confluenceTh">cpu(%,单个)</th>
            <th class="confluenceTh">堆内存</th>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">1</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">300</td>
            <th colspan="1" class="confluenceTh">2050</th>
            <td colspan="1" class="confluenceTd">2248</td>
            <td colspan="1" class="confluenceTd">2354</td>
            <td colspan="1" class="confluenceTd">2572</td>
            <td colspan="1" class="confluenceTd">2662</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">0.50003</td>
            <td colspan="1" class="confluenceTd">77</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2000</th>
            <td colspan="1" class="confluenceTd">8.0</td>
            <td colspan="1" class="confluenceTd">660m</td>
            <td colspan="1" class="confluenceTd">15.0</td>
            <td colspan="1" class="confluenceTd">500m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">2</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">10</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">6316</th>
            <td colspan="1" class="confluenceTd">10091</td>
            <td colspan="1" class="confluenceTd">10432</td>
            <td colspan="1" class="confluenceTd">11112</td>
            <td colspan="1" class="confluenceTd">12404</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">0.91546</td>
            <td colspan="1" class="confluenceTd"><span>77</span></td>
            <td colspan="1" class="confluenceTd"><span>600</span></td>
            <th colspan="1" class="confluenceTh">2000</th>
            <td colspan="1" class="confluenceTd">15.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd">26.0</td>
            <td colspan="1" class="confluenceTd">600m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">3</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd"><span>60</span></td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">19714</th>
            <td colspan="1" class="confluenceTd">31297</td>
            <td colspan="1" class="confluenceTd">33088</td>
            <td colspan="1" class="confluenceTd">39746</td>
            <td colspan="1" class="confluenceTd">41845</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">0.85141</td>
            <td colspan="1" class="confluenceTd">77</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2000</th>
            <td colspan="1" class="confluenceTd">15.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">23.0</td>
            <td colspan="1" class="confluenceTd">600m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">4</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd"><span>5</span></td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">12988</th>
            <td colspan="1" class="confluenceTd">21422</td>
            <td colspan="1" class="confluenceTd">22713</td>
            <td colspan="1" class="confluenceTd">23753</td>
            <td colspan="1" class="confluenceTd">25443</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">0.82763</td>
            <td colspan="1" class="confluenceTd">77</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2000</th>
            <td colspan="1" class="confluenceTd">15.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">23.0</td>
            <td colspan="1" class="confluenceTd">600m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">5</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd"><span>60</span></td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd"><span>30</span></td>
            <td colspan="1" class="confluenceTd">300</td>
            <th colspan="1" class="confluenceTh">2304</th>
            <td colspan="1" class="confluenceTd">2521</td>
            <td colspan="1" class="confluenceTd">2665</td>
            <td colspan="1" class="confluenceTd">3169</td>
            <td colspan="1" class="confluenceTd">3459</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">0.49864</td>
            <td colspan="1" class="confluenceTd">740</td>
            <td colspan="1" class="confluenceTd">7200</td>
            <th colspan="1" class="confluenceTh">2150</th>
            <td colspan="1" class="confluenceTd">8.0</td>
            <td colspan="1" class="confluenceTd">660m</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd">600m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">6</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd"><span>60</span></td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">10</td>
            <td colspan="1" class="confluenceTd">2</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd"><span>120</span></td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">6605</th>
            <td colspan="1" class="confluenceTd">13772</td>
            <td colspan="1" class="confluenceTd">24746</td>
            <td colspan="1" class="confluenceTd">46642</td>
            <td colspan="1" class="confluenceTd">60032</td>
            <td colspan="1" class="confluenceTd">0.667%</td>
            <td colspan="1" class="confluenceTd">1.62541</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">608</td>
            <th colspan="1" class="confluenceTh">2770</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">600m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">7</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">15</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">90</td>
            <td colspan="1" class="confluenceTd">900</td>
            <th colspan="1" class="confluenceTh">3082</th>
            <td colspan="1" class="confluenceTd">3489</td>
            <td colspan="1" class="confluenceTd">4441</td>
            <td colspan="1" class="confluenceTd">5580</td>
            <td colspan="1" class="confluenceTd">6537</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.42068</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3000</th>
            <td colspan="1" class="confluenceTd">35.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">600m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">8</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">6651</th>
            <td colspan="1" class="confluenceTd">8944</td>
            <td colspan="1" class="confluenceTd">12108</td>
            <td colspan="1" class="confluenceTd">19296</td>
            <td colspan="1" class="confluenceTd">51860</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.65295</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3000</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">9</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd"><span>120</span></td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">6818</th>
            <td colspan="1" class="confluenceTd">8769</td>
            <td colspan="1" class="confluenceTd">11503</td>
            <td colspan="1" class="confluenceTd">23196</td>
            <td colspan="1" class="confluenceTd">47418</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.6662</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3000</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">10</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">100</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">8673</th>
            <td colspan="1" class="confluenceTd">11355</td>
            <td colspan="1" class="confluenceTd">17379</td>
            <td colspan="1" class="confluenceTd">35937</td>
            <td colspan="1" class="confluenceTd">60045</td>
            <td colspan="1" class="confluenceTd">0.33%</td>
            <td colspan="1" class="confluenceTd">1.55826</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3000</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">11</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">9315</th>
            <td colspan="1" class="confluenceTd">12913</td>
            <td colspan="1" class="confluenceTd">18000</td>
            <td colspan="1" class="confluenceTd">46211</td>
            <td colspan="1" class="confluenceTd">60035</td>
            <td colspan="1" class="confluenceTd">0.42%</td>
            <td colspan="1" class="confluenceTd">1.53925</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3000</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">12</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">4</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">6297</th>
            <td colspan="1" class="confluenceTd">8577</td>
            <td colspan="1" class="confluenceTd">11401</td>
            <td colspan="1" class="confluenceTd">20061</td>
            <td colspan="1" class="confluenceTd">34485</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.68581</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2750</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">13</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">8</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">6519</th>
            <td colspan="1" class="confluenceTd">8786</td>
            <td colspan="1" class="confluenceTd">12346</td>
            <td colspan="1" class="confluenceTd">21569</td>
            <td colspan="1" class="confluenceTd">37266</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.65904</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2750</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">14</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">1440</td>
            <td colspan="1" class="confluenceTd">14400</td>
            <td colspan="1" class="confluenceTd">10</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">14400</td>
            <th colspan="1" class="confluenceTh">2235</th>
            <td colspan="1" class="confluenceTd">2415</td>
            <td colspan="1" class="confluenceTd">2486</td>
            <td colspan="1" class="confluenceTd">2672</td>
            <td colspan="1" class="confluenceTd">3526</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">0.99918</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2200</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">900m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">15</th>
            <td colspan="1" class="confluenceTd"></td>
            <td colspan="1" class="confluenceTd">360</td>
            <td colspan="1" class="confluenceTd">3600</td>
            <td colspan="1" class="confluenceTd">15</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">90</td>
            <td colspan="1" class="confluenceTd">5400</td>
            <th colspan="1" class="confluenceTh">2845</th>
            <td colspan="1" class="confluenceTd">3445</td>
            <td colspan="1" class="confluenceTd">4141</td>
            <td colspan="1" class="confluenceTd">5259</td>
            <td colspan="1" class="confluenceTd">7660</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.48842</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh"><span>2800</span></th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">1.0g</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">1.4g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">16</th>
            <td colspan="1" class="confluenceTd">指标库集群</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">8398</th>
            <td colspan="1" class="confluenceTd">12253</td>
            <td colspan="1" class="confluenceTd">17298</td>
            <td colspan="1" class="confluenceTd">31302</td>
            <td colspan="1" class="confluenceTd">57404</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.55219</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3000</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">1.0g</td>
            <td colspan="1" class="confluenceTd">50.0</td>
            <td colspan="1" class="confluenceTd">1.4g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">17</th>
            <td rowspan="5" style="text-align: center;" class="confluenceTd">kairosdb 8核单台</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">3156</th>
            <td colspan="1" class="confluenceTd">3143</td>
            <td colspan="1" class="confluenceTd">3493</td>
            <td colspan="1" class="confluenceTd">5072</td>
            <td colspan="1" class="confluenceTd">5897</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.77654</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2700</th>
            <td colspan="1" class="confluenceTd"><span>20.0(8核)</span></td>
            <td colspan="1" class="confluenceTd"><span>800m</span></td>
            <td colspan="1" class="confluenceTd">55.0</td>
            <td colspan="1" class="confluenceTd">1.4g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">18</th>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">8</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">2847</th>
            <td colspan="1" class="confluenceTd">3128</td>
            <td colspan="1" class="confluenceTd">3473</td>
            <td colspan="1" class="confluenceTd">5060</td>
            <td colspan="1" class="confluenceTd">5811</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.87776</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2700</th>
            <td colspan="1" class="confluenceTd">20.0(8核)</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">55.0</td>
            <td colspan="1" class="confluenceTd">1.4g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">19</th>
            <td colspan="1" class="confluenceTd">360</td>
            <td colspan="1" class="confluenceTd">3600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">8</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">7200</td>
            <th colspan="1" class="confluenceTh">2784</th>
            <td colspan="1" class="confluenceTd">2980</td>
            <td colspan="1" class="confluenceTd">3453</td>
            <td colspan="1" class="confluenceTd">5109</td>
            <td colspan="1" class="confluenceTd">5616</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.97834</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2700</th>
            <td colspan="1" class="confluenceTd">20.0(8核)</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">60.0</td>
            <td colspan="1" class="confluenceTd">1.7g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">20</th>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">8</td>
            <td colspan="1" class="confluenceTd">180</td>
            <td colspan="1" class="confluenceTd">1800</td>
            <th colspan="1" class="confluenceTh">7512</th>
            <td colspan="1" class="confluenceTd">10825</td>
            <td colspan="1" class="confluenceTd">12394</td>
            <td colspan="1" class="confluenceTd">23556</td>
            <td colspan="1" class="confluenceTd">35315</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">2.19003</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3300</th>
            <td colspan="1" class="confluenceTd">22.0(8核)</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">72.0</td>
            <td colspan="1" class="confluenceTd">1.9g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">21</th>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">40</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">8</td>
            <td colspan="1" class="confluenceTd">240</td>
            <td colspan="1" class="confluenceTd">2235</td>
            <th colspan="1" class="confluenceTh">10304</th>
            <td colspan="1" class="confluenceTd">16749</td>
            <td colspan="1" class="confluenceTd">28070</td>
            <td colspan="1" class="confluenceTd">58301</td>
            <td colspan="1" class="confluenceTd">60039</td>
            <td colspan="1" class="confluenceTd">2.04%</td>
            <td colspan="1" class="confluenceTd">1.93493</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3400</th>
            <td colspan="1" class="confluenceTd">22.0<span>(8核)</span></td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">72.0</td>
            <td colspan="1" class="confluenceTd">1.9g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">22</th>
            <td rowspan="2" class="confluenceTd">kairosdb 集群（4C*2）</td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">2862</th>
            <td colspan="1" class="confluenceTd">3670</td>
            <td colspan="1" class="confluenceTd">4182</td>
            <td colspan="1" class="confluenceTd">4817</td>
            <td colspan="1" class="confluenceTd">6435</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">1.87606</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">2800</th>
            <td colspan="1" class="confluenceTd">22.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">70.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">23</th>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">180</td>
            <td colspan="1" class="confluenceTd">1800</td>
            <th colspan="1" class="confluenceTh">7022</th>
            <td colspan="1" class="confluenceTd">12305</td>
            <td colspan="1" class="confluenceTd">14342</td>
            <td colspan="1" class="confluenceTd">21109</td>
            <td colspan="1" class="confluenceTd">37044</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">2.30583</td>
            <td colspan="1" class="confluenceTd">80</td>
            <td colspan="1" class="confluenceTd">600</td>
            <th colspan="1" class="confluenceTh">3200</th>
            <td colspan="1" class="confluenceTd">22.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">70.0</td>
            <td colspan="1" class="confluenceTd">2.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">24</th>
            <td rowspan="6" class="confluenceTd"><p>cassandra</p>
                <p>集群</p>
                <p></p></td>
            <td colspan="1" class="confluenceTd">60</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">120</td>
            <td colspan="1" class="confluenceTd">1200</td>
            <th colspan="1" class="confluenceTh">154</th>
            <td colspan="1" class="confluenceTd">163</td>
            <td colspan="1" class="confluenceTd">169</td>
            <td colspan="1" class="confluenceTd">186</td>
            <td colspan="1" class="confluenceTd">3167</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">2.02311</td>
            <td colspan="1" class="confluenceTd">69</td>
            <td colspan="1" class="confluenceTd">604</td>
            <th colspan="1" class="confluenceTh">140</th>
            <td colspan="1" class="confluenceTd">3.0</td>
            <td colspan="1" class="confluenceTd">200m</td>
            <td colspan="1" class="confluenceTd">2.0</td>
            <td colspan="1" class="confluenceTd">2.2g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">25</th>
            <td colspan="1" class="confluenceTd">300</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">900</td>
            <td colspan="1" class="confluenceTd">9000</td>
            <th colspan="1" class="confluenceTh">181</th>
            <td colspan="1" class="confluenceTd">204</td>
            <td colspan="1" class="confluenceTd">212</td>
            <td colspan="1" class="confluenceTd">235</td>
            <td colspan="1" class="confluenceTd">435</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">14.91056</td>
            <td colspan="1" class="confluenceTd">69</td>
            <td colspan="1" class="confluenceTd">604</td>
            <th colspan="1" class="confluenceTh">180</th>
            <td colspan="1" class="confluenceTd">17.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">20.0</td>
            <td colspan="1" class="confluenceTd">2.6g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">26</th>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">35</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1400</td>
            <td colspan="1" class="confluenceTd"><span>14000</span></td>
            <th colspan="1" class="confluenceTh">203</th>
            <td colspan="1" class="confluenceTd">231</td>
            <td colspan="1" class="confluenceTd">242</td>
            <td colspan="1" class="confluenceTd">273</td>
            <td colspan="1" class="confluenceTd">784</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">22.4491</td>
            <td colspan="1" class="confluenceTd">69</td>
            <td colspan="1" class="confluenceTd">604</td>
            <th colspan="1" class="confluenceTh">193</th>
            <td colspan="1" class="confluenceTd">25.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">1.0g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">27</th>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">30</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1500</td>
            <td colspan="1" class="confluenceTd">15000</td>
            <th colspan="1" class="confluenceTh">416</th>
            <td colspan="1" class="confluenceTd">524</td>
            <td colspan="1" class="confluenceTd">551</td>
            <td colspan="1" class="confluenceTd">599</td>
            <td colspan="1" class="confluenceTd">819</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">24.6827</td>
            <td colspan="1" class="confluenceTd">69</td>
            <td colspan="1" class="confluenceTd">601</td>
            <th colspan="1" class="confluenceTh">197</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">33.0</td>
            <td colspan="1" class="confluenceTd">1.4g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">28</th>
            <td colspan="1" class="confluenceTd">700</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">1400</td>
            <td colspan="1" class="confluenceTd"><span>14000</span></td>
            <th colspan="1" class="confluenceTh">204</th>
            <td colspan="1" class="confluenceTd">239</td>
            <td colspan="1" class="confluenceTd">252</td>
            <td colspan="1" class="confluenceTd">293</td>
            <td colspan="1" class="confluenceTd">480</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">23.20079</td>
            <td colspan="1" class="confluenceTd">69</td>
            <td colspan="1" class="confluenceTd">601</td>
            <th colspan="1" class="confluenceTh">199</th>
            <td colspan="1" class="confluenceTd">28.0</td>
            <td colspan="1" class="confluenceTd">700m</td>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">1.2g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">29</th>
            <td colspan="1" class="confluenceTd">4800</td>
            <td colspan="1" class="confluenceTd">7200</td>
            <td colspan="1" class="confluenceTd">35</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd"><span>1400</span></td>
            <td colspan="1" class="confluenceTd">168000</td>
            <th colspan="1" class="confluenceTh">203</th>
            <td colspan="1" class="confluenceTd">232</td>
            <td colspan="1" class="confluenceTd">244</td>
            <td colspan="1" class="confluenceTd">279</td>
            <td colspan="1" class="confluenceTd">800</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">24.6765</td>
            <td colspan="1" class="confluenceTd">69</td>
            <td colspan="1" class="confluenceTd">604</td>
            <th colspan="1" class="confluenceTh">180</th>
            <td colspan="1" class="confluenceTd">28.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">1.2g</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">30</th>
            <td rowspan="2" class="confluenceTd"><p>cassandra</p>
                <p>集群，写入一段时间数据后。</p></td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">400</td>
            <td colspan="1" class="confluenceTd">4000</td>
            <th colspan="1" class="confluenceTh">675</th>
            <td colspan="1" class="confluenceTd">760</td>
            <td colspan="1" class="confluenceTd">791</td>
            <td colspan="1" class="confluenceTd">871</td>
            <td colspan="1" class="confluenceTd">1264</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">6.57273</td>
            <td colspan="1" class="confluenceTd">70</td>
            <td colspan="1" class="confluenceTd">605</td>
            <th colspan="1" class="confluenceTh">641</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">500m</td>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        <tr>
            <th colspan="1" class="confluenceTh">31</th>
            <td colspan="1" class="confluenceTd">250</td>
            <td colspan="1" class="confluenceTd">600</td>
            <td colspan="1" class="confluenceTd">20</td>
            <td colspan="1" class="confluenceTd">1</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">200</td>
            <td colspan="1" class="confluenceTd">5</td>
            <td colspan="1" class="confluenceTd">500</td>
            <td colspan="1" class="confluenceTd">5000</td>
            <th colspan="1" class="confluenceTh">5140</th>
            <td colspan="1" class="confluenceTd">8497</td>
            <td colspan="1" class="confluenceTd">8778</td>
            <td colspan="1" class="confluenceTd">9076</td>
            <td colspan="1" class="confluenceTd">15704</td>
            <td colspan="1" class="confluenceTd">0.00%</td>
            <td colspan="1" class="confluenceTd">7.12069</td>
            <td colspan="1" class="confluenceTd">70</td>
            <td colspan="1" class="confluenceTd">605</td>
            <th colspan="1" class="confluenceTh">671</th>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd"><span>500m</span></td>
            <td colspan="1" class="confluenceTd">30.0</td>
            <td colspan="1" class="confluenceTd">800m</td>
            <td colspan="1" class="confluenceTd"></td>
        </tr>
        </tbody>
    </table>
</div>
<p style="margin-left: 30.0px;">过程：</p>
<ol>
    <li>可以看到单Cassandra节点下，kairosdb查询Cassandra最短耗时已经在2S左右，而集群模式下，kairosdb查询Cassandra的最短耗时在200ms
        左右，可以看出在低硬件配置下，Cassandra部署集群模式比单机模式的性能提升很大。
    </li>
    <li>Cassandra刚部署时，查询性能表现优秀，连续写入一个小时数据后，查询性能下降。</li>
    <li>2-5组发现kairosdb 查询时间正常， 但指标库查询出现超时，经建飞排查，原因是调用kairosdb client时创建的 http连接 最大数量最2，修改为200后，情况好转。<br/>


  {% asset_img  image2017-12-8_11_24_9.png %}

    </li>
    <li>从测试过程可以看到，部分指标库的查询耗时比kairosdb查Cassandra的耗时长很多，查询kairosdb.datastore.queries_waiting
        指标，发现kairosdb存在大量等待线程。如下：<br/><br/>
        
{% asset_img  kairosdb.datastore.queries_waiting.png %}

          <br/>修改
        kairosdb 的配置：kairosdb.datastore.concurrentQueryThread ，再次查询，依然会有等待的查询线程。<br/>据此判断，当查询15个指标时，每个指标耗时在2.5S左右时，此硬件配置下的kairosdb性能已达瓶颈，影响因素为CPU核数。当更改部署kairosdb
        机器的核数后，性能得到了提升。
    </li>
    <li>同样的查询条件下，CPU核数与kairosdb 的concurrentQueryThread 参数一致时，性能最优；且该参数只在kairosdb 查Cassandra较慢（2S以上）时，才会产生影响。</li>
</ol>
<h2 id="id-指标库性能测试-五、结论"><br/>五、结论</h2>
<h3 id="id-指标库性能测试-1、指标库写性能：">1、指标库写性能：</h3>
<ol>
    <li>由3、5、6组可知，每分钟请求总量一定的情况下，在未到达瓶颈前，并发线程越多，指标写入量越大。</li>
    <li>由6、8组可知，本机的机器性能并未成为影响指标写入的因素。</li>
    <li>由6、7和8、9两组可知，在4核16G单节点Cassandra 配置下，请求数在50W/min 左右时，指标库的gateway 模块接收请求已到达瓶颈，为 <strong>50W /min</strong> 左右。</li>
    <li>由9、10、11三组可知，在指标写入能力到达瓶颈后，改变并发的线程数，不再产生影响。</li>
    <li>由9、12组可知，待写入的指标类型量不是影响因素。</li>
    <li>由15组可知，当指标库写入请求量每分钟到千万级时，会出现redis 内存问题。</li>
    <li>单指标库、单Cassandra节点下，指标写入能力瓶颈在Cassandra处，为 <strong>80W/min</strong>；<br/>多指标库、单Cassandra节点下，指标写入能力瓶颈在Cassandra处，为
        <strong>85W/min</strong>；<br/>单指标库、多Cassandra节点下，指标写入能力瓶颈为 <strong>100W/min</strong>；<br/>多指标库、多Cassandra节点下，指标写入能力瓶颈为<strong>
            <strong>110W/min</strong></strong>。<br/><br/><br/></li>
</ol>
<p></p>
<p>配置预估：</p>
<p style="margin-left: 30.0px;">假设现场1个资源每15 S上报100个指标，则每分钟上报400个，若采用单节点Cassandra
    配置，在redis集群状况良好的情况下，可支持1750个资源左右，考虑到稳定性可酌情减少资源量或增加配置。</p>
<p style="margin-left: 30.0px;"></p>
<h3 id="id-指标库性能测试-2、指标库读性能：">2、指标库读性能：</h3>
<ol>
    <li>由1、2组可知R12版本指标库在现有配置下，最多支持每分钟30次的查询。</li>
    <li>由2、3组可知，查询较慢时，每10S钟查询10次，比每5S钟查询5次，查询要快。</li>
    <li>由2、4组可知，相同的请求量下，同一个指标密集查询2次，比两个指标同时各查一次要慢很多。</li>
    <li>由1、5组可知，查询的数据量从600到7200，查询的Cassandra row从 77到740，查询耗时基本没有变化，不过Cassandra的资源消耗增加很多。</li>
    <li>由2、7组可知，kairosdb client 创建的 http连接 最大数量与查询性能十分相关，R13中已调整该参数为200。</li>
    <li>由6-8、14、15组可知，单Cassandra节点下，指标查询的瓶颈为 <strong>90次/分钟</strong>，且当 指标库的查询耗时 与
        kairosdb查Cassandra的耗时相差不大时，可以维持稳定查询状态，否则指标库查询超时会越来越严重。
    </li>
    <li>由8-13、17-19组可知，kairosdb的concurrentQueryThread 参数值与CPU核数一致时，性能最优；且该参数只在kairosdb 查Cassandra较慢（2S以上）时，才会产生影响。</li>
    <li>由8、16组可知，指标库是否集群模式不是瓶颈。</li>
    <li>由19、22和20、23两组可知，单kairosdb 8核的查询性能 与双kairosdb 4核基本相同，所以kairosdb 的查询性能与机器的CPU核数有关。</li>
    <li>由19、24组可知，当前的查询瓶颈在Cassandra 处，Cassandra 集群的查询性能是单节点的10倍。</li>
    <li>由24-29组可知，Cassandra集群下，查询性能瓶颈为<strong>1400次/分钟</strong>，当查询到1500次/分钟时，kairosdb出现瓶颈，等待查询线程不断增加。</li>
    <li>由30、31组可知，当Cassandra写入一段时间数据后，指标查询性能下降很多。</li>
</ol>

