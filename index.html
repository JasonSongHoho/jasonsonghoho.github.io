<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="jason's blog" type="application/atom+xml" />






<meta name="description" content="åˆ›é€ ç¾å¥½ï¼">
<meta property="og:type" content="website">
<meta property="og:title" content="jason&#39;s blog">
<meta property="og:url" content="https://jasonsonghoho.github.io/index.html">
<meta property="og:site_name" content="jason&#39;s blog">
<meta property="og:description" content="åˆ›é€ ç¾å¥½ï¼">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jason&#39;s blog">
<meta name="twitter:description" content="åˆ›é€ ç¾å¥½ï¼">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jasonsonghoho.github.io/"/>





  <title>jason's blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?72b386cef7d7f109725797247e159526";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jason's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/10/08/BitMapã€BitSetä¸Bloom Filter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/08/BitMapã€BitSetä¸Bloom Filter/" itemprop="url">BitMapã€BitSetä¸Bloom Filter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-08T10:36:11+08:00">
                2018-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>æ¨èé˜…è¯»æ—¶é—´ï¼š5åˆ†é’Ÿ</em></p>
<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>å…ˆæ¥çœ‹ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾ç°åœ¨æœ‰èŒƒå›´ä¸º 1-10 äº¿çš„ 11 äº¿ä¸ª int å‹æ•´æ•°ï¼Œå¦‚ä½•æ’é™¤æ‰å…¶ä¸­çš„é‡å¤æ•°å­—ï¼Ÿint å  4 ä¸ªå­—èŠ‚ï¼Œå¯ä»¥è¡¨ç¤º -2,147,483,648 ~ +2,147,483,647 çš„æ•°æ®ã€‚<br>æ‰€ä»¥ä¸€èˆ¬çš„æ€è·¯æ˜¯ä¼šå°†è¿™ 11 äº¿ä¸ªæ•°ä½œä¸º int å‹æ•°æ®å­˜åˆ°ä¸€ä¸ª HashSet é›†åˆä¸­è¿›è¡Œå»é‡ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“ 1GB=1024KB=1024 <em> 1024Byte,é‚£ä¹ˆ 10äº¿ </em> 4Byte å°†å ç”¨æ¥è¿‘ 4GB çš„å†…å­˜ï¼Œè¿™å°†æ˜¯æå¤§çš„æ€§èƒ½æµªè´¹ï¼Œå¾ˆå¯èƒ½ä¼šå½±å“ç¨‹åºçš„å¥åº·è¿è¡Œã€‚</p>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨â€ä½æ˜ å°„ï¼ˆBitMapï¼‰â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªä½æ•°ç»„ï¼ˆbit[n]ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ bit[i] æ¥è¡¨ç¤º 0-n ä¸­å¯¹åº”çš„æ•°å­—ï¼Œæ¯ä¸ªå…ƒç´ æœ‰ 1 å’Œ 0 ä¸¤ä¸ªå–å€¼ï¼Œåˆ†åˆ«ä»£è¡¨è¯¥æ•°å­—å­˜åœ¨ä¸å¦ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è®°å½•ä¸€ä¸ªæ•°å­—åªéœ€è¦ä¸€ä¸ª bitï¼Œç›¸å¯¹äºä¹‹å‰çš„ int ç±»å‹(32 bit)ï¼Œæ•´æ•´ç¼©å°äº† 32 å€çš„å­˜å‚¨å¤§å°(4GB/32=125MB)!</p>
<p>æ‰©å±•ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬éœ€è¦è®°å½•æ¯ä¸ªæ•°å­—å‡ºç°æ¬¡æ•°æ˜¯å¦è¶…è¿‡ 2 æ¬¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿ç»­çš„ä¸¤ä½æ¥è®°å½•ä¸€ä¸ªæ•°å­—ï¼šä¸€ä½ç”¨æ¥è®°å½•æ˜¯å¦å‡ºç°ï¼Œå¦ä¸€ä½ç”¨æ¥è®°å½•æ˜¯å¦è¶…è¿‡ 2 æ¬¡ã€‚</p>
<p>ä¸è¿‡ï¼ŒJava ä¸­æ— æ³•åˆ›å»º bit æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ int æˆ– long æ•°ç»„æ¥å®ç°è¿™ä¸ªç›®çš„ã€‚å»ºç«‹ä¸€ä¸ª int æ•°ç»„ int[n]ï¼Œint[0] è®°å½•äº† 0-31ï¼Œint[1] è®°å½•äº† 32-63 â€¦â€¦ ä¾æ­¤ç±»æ¨ã€‚</p>
<h3 id="Java-BitSet"><a href="#Java-BitSet" class="headerlink" title="Java BitSet"></a>Java BitSet</h3><p>Java ä¸­æœ‰ä¸€ä¸ª BitSet ç±»ï¼Œä»å‘½åå°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ç”¨æ¥å­˜å‚¨å»é‡çš„ä½å…ƒç´ é›†åˆï¼Œå®ƒè¿˜æ”¯æŒ andã€or ç­‰ä½è¿ç®—ã€‚ç”¨æ¥è§£å†³æ–‡ç« å¼€å¤´çš„é—®é¢˜éå¸¸åˆé€‚ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitSetStudy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        BitSet bitSet = <span class="keyword">new</span> BitSet(<span class="number">1000000000</span>);</span><br><span class="line">        <span class="comment">//éšæœºç”Ÿæˆ 11 äº¿ä¸ªæ•°å­—</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1100000000</span>; i++) &#123;</span><br><span class="line">            bitSet.set((<span class="keyword">int</span>) (Math.random() * <span class="number">1000000000</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(bitSet.size());</span><br><span class="line">        System.out.println(<span class="string">"end"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€ jconsole,å¯ä»¥çœ‹åˆ°å­˜å‚¨äº† bitset å¯¹è±¡çš„è€å¹´ä»£æ‰€å ç”¨çš„å†…å­˜ç¨³å®šåœ¨ 125MB å·¦å³ã€‚</p>
<img src="/2018/10/08/BitMapã€BitSetä¸Bloom%20Filter/bitset-mem.png">
<p>å…³äº BitSet çš„ andã€andNotã€orã€xor æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    BitSet bitSet = <span class="keyword">new</span> BitSet();</span><br><span class="line">    bitSet.set(<span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">    BitSet bitSet1 = <span class="keyword">new</span> BitSet();</span><br><span class="line">    bitSet1.set(<span class="number">4</span>, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    BitSet bitSetAnd = (BitSet) bitSet.clone();</span><br><span class="line">    BitSet bitSetAndNot = (BitSet) bitSet.clone();</span><br><span class="line">    BitSet bitSetOr = (BitSet) bitSet.clone();</span><br><span class="line">    BitSet bitSetXor = (BitSet) bitSet.clone();</span><br><span class="line"></span><br><span class="line">    bitSetAnd.and(bitSet1);</span><br><span class="line">    bitSetAndNot.andNot(bitSet1);</span><br><span class="line">    bitSetOr.or(bitSet1);</span><br><span class="line">    bitSetXor.xor(bitSet1);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"bitSet is : "</span> + bitSet + <span class="string">" , and bitSet1 is: "</span> + bitSet1);</span><br><span class="line">    System.out.println(<span class="string">"run bitSet.XMethod(bitSet1) , result is : "</span>);</span><br><span class="line">    System.out.println(<span class="string">"and:"</span> + bitSetAnd);</span><br><span class="line">    System.out.println(<span class="string">"andNot:"</span> + bitSetAndNot);</span><br><span class="line">    System.out.println(<span class="string">"or:"</span> + bitSetOr);</span><br><span class="line">    System.out.println(<span class="string">"xor:"</span> + bitSetXor);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bitSet is : &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125; , and bitSet1 is: &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</span><br><span class="line">run bitSet.XMethod(bitSet1) , result is :</span><br><span class="line">and:&#123;<span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">andNot:&#123;<span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">or:&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</span><br><span class="line">xor:&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="è‡ªå·±å®ç°-BitMap"><a href="#è‡ªå·±å®ç°-BitMap" class="headerlink" title="è‡ªå·±å®ç° BitMap"></a>è‡ªå·±å®ç° BitMap</h3><p>Java çš„ BitSet ä½¿ç”¨èµ·æ¥å­˜åœ¨å±€é™æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ BitSet å®ç°è‡ªå·±çš„ BitMap æ¥æ‰©å±•åº”ç”¨åœºæ™¯ã€‚æ ¸å¿ƒè¿˜æ˜¯é€šè¿‡ int/long æ•°ç»„å…ƒç´ çš„ä½æ¥è®°å½•æœ‰åºæ•°æ®ï¼Œä¸€ä¸ªå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitMap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] words;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BitMap</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        size = n;</span><br><span class="line">        <span class="comment">//æ¯ä¸ªintå 32ä½ï¼Œæ•°ç»„å¤§å°ä¸º n/32+1</span></span><br><span class="line">        words = <span class="keyword">new</span> <span class="keyword">int</span>[(size &gt;&gt; <span class="number">5</span>) + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> bit)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è·å¾—æ•°æ®æ‰€åœ¨çš„æ•°ç»„åºå·ï¼ˆintï¼‰ï¼Œç›¸å½“äº bit/32</span></span><br><span class="line">        <span class="keyword">int</span> i = bit &gt;&gt; <span class="number">5</span>;</span><br><span class="line">        <span class="comment">//è·å¾—è¯¥intå…ƒç´ ä¸­è¦ä¿®æ”¹ä¸º1çš„æ•°å­—,ç›¸å½“äº bit%32</span></span><br><span class="line">        <span class="keyword">int</span> j = bit &amp; <span class="number">31</span>;</span><br><span class="line">        <span class="comment">//è·å¾—è¦ä¿®æ”¹çš„ä½</span></span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">1</span> &lt;&lt; j;</span><br><span class="line">        <span class="comment">//å°†è¯¥å…ƒç´ ç›¸åº”çš„äºŒè¿›åˆ¶ä½è®¾ä¸º1</span></span><br><span class="line">        words[i] |= k ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> bit)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å‚è€ƒsetæ–¹æ³•ç†è§£</span></span><br><span class="line">        <span class="keyword">return</span> (words[bit &gt;&gt; <span class="number">5</span>] &amp; (<span class="number">1</span> &lt;&lt; (bit &amp; <span class="number">31</span>))) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°äº†æ ¸å¿ƒçš„å­˜å‚¨ç»“æ„ã€set å’Œ get æ–¹æ³•ã€‚</p>
<h3 id="å¸ƒéš†è¿‡æ»¤å™¨-Bloom-Filter"><a href="#å¸ƒéš†è¿‡æ»¤å™¨-Bloom-Filter" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)"></a>å¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)</h3><p>äº†è§£å®Œ BitMap,æˆ‘ä»¬æŒæ¡äº†ä¸€ç§å¤„ç†å¤§é‡è¿ç»­æ•°æ®çš„å¥½æ–¹æ³•ã€‚ç°åœ¨ç»§ç»­æ‰©å±•ä¸€ä¸‹ï¼Œç°åœ¨å¦‚æœæˆ‘ä»¬è¦è®°å½•çš„æ˜¯æµ·é‡çš„åˆ†å¸ƒå¾ˆä¸å‡åŒ€çš„æ•°æ®ï¼Œå¦‚æœç»§ç»­ç”¨ BitMap çš„æ–¹å¼ï¼Œå°†ä¼šæµªè´¹å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œæˆ–è€…æ•°æ®é‡å·²ç»å¤§åˆ°ä½¿ç”¨ BitMap çš„æ–¹å¼ï¼Œä»ç„¶ä¼šæµªè´¹å¤§é‡çš„å†…å­˜ç©ºé—´ã€‚é¢å¯¹è¿™ä¸¤ç§æƒ…æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨æ ¸å¿ƒæ˜¯å¯¹ä¸€ä¸ª key ä½¿ç”¨å¤šä¸ª hash å‡½æ•°æ±‚å‡ºå¤šä¸ªå€¼ï¼Œå°†è¿™äº›å€¼æ•£åˆ—åœ¨ä¸€ä¸ªæœ‰é™çš„æ•°ç»„ä¸­ï¼Œè¿™æ ·ï¼Œå½“è¿™äº› hash å‡½æ•°æ±‚å‡ºçš„å€¼éƒ½ç¬¦åˆé¢„æœŸå°±è®¤ä¸ºè¯¥ key å­˜åœ¨ï¼›è‹¥åªè¦å­˜åœ¨ hash å‡½æ•°çš„å€¼ä¸ç¬¦åˆï¼Œå°±å¯ä»¥ç¡®å®šå®ƒä¸å­˜åœ¨ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œè¿™ç§æ–¹æ³•æ•ˆæœéå¸¸å¥½ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š</p>
<img src="/2018/10/08/BitMapã€BitSetä¸Bloom%20Filter/bloom_filter.jpeg">
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ç§æ–¹æ³•å­˜åœ¨ä¸€å®šè¯¯å·®ï¼Œä¸è¿‡è¯¯å·®å‡ ç‡å¯ä»¥é€šè¿‡å¢åŠ  hash å‡½æ•°å’Œæ•£åˆ—æ•°ç»„å¤§å°æ¥å‡å°ã€‚è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå½“æŸä¸ª key è¢«åˆ é™¤åï¼Œä¸èƒ½ç›´æ¥åœ¨æ•£åˆ—è¡¨ä¸­å°†å¯¹åº”çš„ value å»æ‰ï¼Œå› ä¸ºå¯èƒ½ä¼šå½±å“å…¶ä»– keyã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªé»‘åå•ï¼Œæ¯æ¬¡è®¡ç®— hash å‰ï¼Œå…ˆåˆ¤æ–­ key æ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Œæœ‰åˆ™è¡¨ç¤ºè¯¥ key å·²åˆ æ‰ã€‚</p>
<img src="/2018/10/08/BitMapã€BitSetä¸Bloom%20Filter/IMG_1753.GIF" title="10æ ‹*7å±‚*2ï¼ˆè‡³å°‘2ï¼‰å¥—=140å¥— å‘µå‘µğŸ˜…">

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/09/24/Java-8-HashMap-ä¸Š-â€”â€”-çº¢é»‘æ ‘/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/24/Java-8-HashMap-ä¸Š-â€”â€”-çº¢é»‘æ ‘/" itemprop="url">Java 8 HashMap(ä¸Š)â€”â€” çº¢é»‘æ ‘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-24T00:19:04+08:00">
                2018-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>æ¨èé˜…è¯»æ—¶é—´ï¼š10åˆ†é’Ÿ</em></p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><blockquote>
<p>Java8çš„æœ€å¤§ç‰¹æ€§æ˜¯ä½¿ç”¨çº¢é»‘æ ‘ç»“æ„æ¥å­˜å‚¨æ¯ä¸ªï¼ˆæ¡¶ï¼‰bucketä¸­çš„æ•°æ®ï¼ˆå½“é“¾è¡¨é•¿åº¦è¶…è¿‡8æ—¶ï¼‰ã€‚<br>ä¸ºä»€ä¹ˆå¼•å…¥çº¢é»‘æ ‘å‘¢ï¼Ÿå…¶å®æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¹³å‡æ¯ä¸ªæ¡¶ä¸­åº”è¯¥åªä¼šæœ‰ä¸åˆ°1ä¸ªæ•°æ®ï¼Œä½†å½“å‘ç”Ÿå¤§é‡Hashç¢°æ’æ—¶ï¼Œæ¯ä¸ªæ¡¶ä¸­çš„æ•°æ®ä¹Ÿå°†ä¼šå¤§é‡å¢åŠ ï¼Œè¿™å°†ä¼šå½±å“åˆ°æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ã€‚åœ¨Java7ä¸­ï¼Œæ¯ä¸ªæ¡¶ä½¿ç”¨é“¾è¡¨å­˜å‚¨æ•°æ®ï¼ŒæŸ¥æ‰¾æ•°æ®é‡‡ç”¨éå†çš„æ–¹å¼ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚Java7ä¸­ä¸ºäº†é¿å…å¤§é‡Hashç¢°æ’çš„é—®é¢˜ï¼Œå¼•å…¥äº†hashseedæ–¹å¼ï¼Œå¢å¼ºäº†Hashå‡½æ•°çš„æ•£åˆ—æ€§ã€‚ä½†æ˜¯randomHashSeedæ–¹æ³•è°ƒç”¨çš„nextæ–¹æ³•åœ¨å¤šçº¿ç¨‹è¿ç®—æ—¶å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼ˆå¾…è€ƒè¯ï¼‰ï¼Œæ•…åœ¨Java8ä¸­è¢«å¼ƒç”¨ã€‚Java8ä¸­æ¢äº†ä¸€ä¸ªæ€è·¯ï¼šä½¿ç”¨çº¢é»‘æ ‘æ¥æé«˜æŸ¥æ‰¾é€Ÿåº¦ï¼ˆO(logN)ï¼‰ï¼Œå³ä½¿å‘ç”Ÿå¤§é‡hashç¢°æ’ä¹Ÿä¸ä¼šé€ æˆæ€§èƒ½å½±å“ï¼Œè¿™ä¾¿æ˜¯çº¢é»‘æ ‘ç”±æ¥çš„åŸå› ã€‚<br>Java7çš„HashMapä¸€å…±æœ‰æ¥è¿‘1200è¡Œä»£ç ï¼Œè€Œåˆ°äº†Java8ç›´æ¥å¢åŠ åˆ°äº†2400è¡Œï¼Œå‡å»å…¨å±€å˜é‡å‰æ–°åŠ çš„100è¡Œæ³¨é‡Šï¼Œç›¸å·®1100è¡Œã€‚å…¶ä¸­TreeNode(çº¢é»‘æ ‘)å®ç°éƒ¨åˆ†æœ‰600è¡Œä»£ç ï¼Œå†åŠ ä¸Šå…¶ä»–æ–¹æ³•å¯¹çº¢é»‘æ ‘çš„é€‚åº”æ€§æ”¹åŠ¨ï¼Œå¯è§çº¢é»‘æ ‘éƒ¨åˆ†æ˜¯Java8 HashMapçš„ä¸»è¦æ”¹åŠ¨ã€‚  </p>
</blockquote>
<h3 id="è¯¦æƒ…"><a href="#è¯¦æƒ…" class="headerlink" title="è¯¦æƒ…"></a>è¯¦æƒ…</h3><h4 id="ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š"><a href="#ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š" class="headerlink" title="ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š"></a>ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š</h4><img src="/2018/09/24/Java-8-HashMap-ä¸Š-â€”â€”-çº¢é»‘æ ‘/20180923214733.png">
<p>TreeNodeç»§æ‰¿äº†LinkedHashMap.Entryï¼ŒLinkedHashMap.Entryç»§æ‰¿äº†HashMap.Nodeï¼Œè€ŒNodeå…¶å®å°±æ˜¯ä¸Šä¸ªç‰ˆæœ¬çš„Entryï¼ˆé“¾è¡¨ï¼‰ç»“æ„ã€‚æ­¤å¤„æœ‰ä¸ªç–‘æƒ‘ï¼šTreeNodeå¹¶æ²¡æœ‰ä½¿ç”¨LinkedHashMap.Entryçš„beforeå’Œafterå­—æ®µï¼Œä¸çŸ¥é“ä¸ºå•¥ä¸ç›´æ¥ç»§æ‰¿Nodeç±»ã€‚</p>
<h4 id="å­—æ®µå’Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š"><a href="#å­—æ®µå’Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š" class="headerlink" title="å­—æ®µå’Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š"></a>å­—æ®µå’Œæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//å¸¸è§çš„æ ‘ç»“æ„</span></span><br><span class="line">    HashMap.TreeNode&lt;K, V&gt; parent;</span><br><span class="line">    HashMap.TreeNode&lt;K, V&gt; left;</span><br><span class="line">    HashMap.TreeNode&lt;K, V&gt; right;</span><br><span class="line">    HashMap.TreeNode&lt;K, V&gt; prev;</span><br><span class="line">    <span class="keyword">boolean</span> red;</span><br><span class="line"></span><br><span class="line">    TreeNode(<span class="keyword">int</span> hash, K key, V val, HashMap.Node&lt;K, V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">super</span>(hash, key, val, next);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="çº¢é»‘æ ‘å…¨éƒ¨æ–¹æ³•å¦‚ä¸‹ï¼š"><a href="#çº¢é»‘æ ‘å…¨éƒ¨æ–¹æ³•å¦‚ä¸‹ï¼š" class="headerlink" title="çº¢é»‘æ ‘å…¨éƒ¨æ–¹æ³•å¦‚ä¸‹ï¼š"></a>çº¢é»‘æ ‘å…¨éƒ¨æ–¹æ³•å¦‚ä¸‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ ¹ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="keyword">final</span> HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; r = <span class="keyword">this</span>, p;;) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((p = r.parent) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        r = p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€‰å–æ ¹ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘è¿›è¡Œå·¦æ—‹ã€å³æ—‹åï¼Œæ ¹ç»“ç‚¹å¯èƒ½ç§»åŠ¨ï¼Œå¤´ç»“ç‚¹éœ€è¦é‡æ–°æŒ‡å‘æ–°çš„æ ¹ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">moveRootToFront</span><span class="params">(HashMap.Node&lt;K,V&gt;[] tab, HashMap.TreeNode&lt;K,V&gt; root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="keyword">null</span> &amp;&amp; tab != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = (n - <span class="number">1</span>) &amp; root.hash;</span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; first = (HashMap.TreeNode&lt;K,V&gt;)tab[index];</span><br><span class="line">        <span class="comment">//å¦‚æœæ ¹ç»“ç‚¹ä¸æ˜¯æ¡¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å°†æ ¹ç»“ç‚¹ç§»åŠ¨åˆ°å¤´ç»“ç‚¹ä½ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (root != first) &#123;</span><br><span class="line">            HashMap.Node&lt;K,V&gt; rn;</span><br><span class="line">            tab[index] = root;</span><br><span class="line">            HashMap.TreeNode&lt;K,V&gt; rp = root.prev;</span><br><span class="line">            <span class="keyword">if</span> ((rn = root.next) != <span class="keyword">null</span>)</span><br><span class="line">                ((HashMap.TreeNode&lt;K,V&gt;)rn).prev = rp;</span><br><span class="line">            <span class="keyword">if</span> (rp != <span class="keyword">null</span>)</span><br><span class="line">                rp.next = rn;</span><br><span class="line">            <span class="keyword">if</span> (first != <span class="keyword">null</span>)</span><br><span class="line">                first.prev = root;</span><br><span class="line">            root.next = first;</span><br><span class="line">            root.prev = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ–­è¨€çº¢é»‘æ ‘ç»“æ„æ˜¯å¦æ­£å¸¸ï¼Œä¸æ­£å¸¸åˆ™æŠ¥å¼‚å¸¸åœæ­¢</span></span><br><span class="line">        <span class="function"><span class="keyword">assert</span> <span class="title">checkInvariants</span><span class="params">(root)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç»“ç‚¹hashå€¼ã€keyå’Œkeyçš„ç±»å‹ è¿›è¡Œçº¢é»‘æ ‘æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">find</span><span class="params">(<span class="keyword">int</span> h, Object k, Class&lt;?&gt; kc)</span> </span>&#123;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; p = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> ph, dir; K pk;</span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; pl = p.left, pr = p.right, q;</span><br><span class="line">        <span class="comment">//å¾…æŸ¥è¯¢ç»“ç‚¹çš„keyçš„hashå€¼è‹¥å°äºå½“å‰ç»“ç‚¹åˆ™è¿›å…¥å·¦å­æ ‘ï¼Œå¦åˆ™è¿›å…¥å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">            p = pl;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">            p = pr;</span><br><span class="line">        <span class="comment">//å¦‚æœhashå€¼ç›¸ç­‰å†æ¯”è¾ƒkeyï¼Œä¸€è‡´åˆ™è¡¨ç¤ºæ‰¾åˆ°ï¼Œè¿”å›ç»“æœ</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((pk = p.key) == k || (k != <span class="keyword">null</span> &amp;&amp; k.equals(pk)))</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pl == <span class="keyword">null</span>)</span><br><span class="line">            p = pr;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pr == <span class="keyword">null</span>)</span><br><span class="line">            p = pl;</span><br><span class="line">        <span class="comment">//å¦‚æœkeyä¸åŒï¼Œåˆ™çœ‹keyçš„ç±»å‹æ˜¯å¦å¯æ¯”è¾ƒï¼Œ</span></span><br><span class="line">        <span class="comment">//å¦‚æœå¯ä»¥æ¯”è¾ƒåˆ™æ ¹æ®æ¯”è¾ƒç»“æœé€‰æ‹©æ˜¯å¦è¿”å›æŸ¥è¯¢ç»“æœï¼Œè¿˜æ˜¯ç»§ç»­æŸ¥è¯¢å·¦ã€å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((kc != <span class="keyword">null</span> ||</span><br><span class="line">                (kc = comparableClassFor(k)) != <span class="keyword">null</span>) &amp;&amp;</span><br><span class="line">                (dir = compareComparables(kc, k, pk)) != <span class="number">0</span>)</span><br><span class="line">            p = (dir &lt; <span class="number">0</span>) ? pl : pr;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((q = pr.find(h, k, kc)) != <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> q;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p = pl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (p != <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç»“ç‚¹hashå€¼ã€key è¿›è¡Œçº¢é»‘æ ‘æŸ¥æ‰¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">getTreeNode</span><span class="params">(<span class="keyword">int</span> h, Object k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((parent != <span class="keyword">null</span>) ? root() : <span class="keyword">this</span>).find(h, k, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼ºåˆ¶æ¯”è¾ƒä¸¤ä¸ªç»“ç‚¹çš„key</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å½“ä¸¤ä¸ªç±»å‹ä¸èƒ½ç›´æ¥æ¯”è¾ƒæ—¶ï¼Œé€šè¿‡å¯¹ç±»åè¿›è¡Œhashè¿›è¡Œæ¯”è¾ƒï¼›è‹¥hashå€¼ä¹Ÿç›¸ç­‰ï¼Œåˆ¤å®šbå¤§ã€‚</span></span><br><span class="line"><span class="comment"> * æ•…ä¸€å®šä¼šæ’å‡ºå…ˆåé¡ºåºã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tieBreakOrder</span><span class="params">(Object a, Object b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="keyword">null</span> || b == <span class="keyword">null</span> ||</span><br><span class="line">            (d = a.getClass().getName().</span><br><span class="line">                    compareTo(b.getClass().getName())) == <span class="number">0</span>)</span><br><span class="line">        d = (System.identityHashCode(a) &lt;= System.identityHashCode(b) ?</span><br><span class="line">                -<span class="number">1</span> : <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line"><span class="comment"> * é‡è¦æ–¹æ³•ï¼å½“é“¾è¡¨é•¿åº¦å¢åŠ åˆ°çº¢é»‘æ ‘è½¬æ¢é˜ˆå€¼ï¼ˆé»˜è®¤8ï¼‰ï¼Œä¸”æ¡¶çš„æ•°é‡ä¸å°äº64 æ—¶è§¦å‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeify</span><span class="params">(HashMap.Node&lt;K,V&gt;[] tab)</span> </span>&#123;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; root = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//éå†é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; x = <span class="keyword">this</span>, next; x != <span class="keyword">null</span>; x = next) &#123;</span><br><span class="line">        next = (HashMap.TreeNode&lt;K,V&gt;)x.next;</span><br><span class="line">        x.left = x.right = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//é¦–ç»“ç‚¹ä½œä¸ºæ ¹ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            x.parent = <span class="keyword">null</span>;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            root = x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            K k = x.key;</span><br><span class="line">            <span class="keyword">int</span> h = x.hash;</span><br><span class="line">            Class&lt;?&gt; kc = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; p = root;;) &#123;</span><br><span class="line">                <span class="keyword">int</span> dir, ph;</span><br><span class="line">                K pk = p.key;</span><br><span class="line">                <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">                    dir = -<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">                    dir = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((kc == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                        (kc = comparableClassFor(k)) == <span class="keyword">null</span>) ||</span><br><span class="line">                        (dir = compareComparables(kc, k, pk)) == <span class="number">0</span>)</span><br><span class="line">                    <span class="comment">//å¦‚æœæœªèƒ½æ¯”è¾ƒï¼Œè°ƒç”¨å¼ºåˆ¶æ¯”è¾ƒæ–¹æ³•ï¼Œç¡®ä¿æœ‰åº</span></span><br><span class="line">                    dir = tieBreakOrder(k, pk);</span><br><span class="line"></span><br><span class="line">                HashMap.TreeNode&lt;K,V&gt; xp = p;</span><br><span class="line">                <span class="comment">//å½“å·¦æˆ–å³å­æ ‘ä¸ºç©ºæ—¶ï¼Œæ’å…¥é“¾è¡¨ä¸Šçš„ä¸€ä¸ªç»“ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> ((p = (dir &lt;= <span class="number">0</span>) ? p.left : p.right) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    x.parent = xp;</span><br><span class="line">                    <span class="keyword">if</span> (dir &lt;= <span class="number">0</span>)</span><br><span class="line">                        xp.left = x;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        xp.right = x;</span><br><span class="line">                    <span class="comment">//æ’å…¥ç»“ç‚¹åï¼Œè¿›è¡Œå·¦æ—‹ã€å³æ—‹é‡å¹³è¡¡ï¼Œè½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    root = balanceInsertion(root, x);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç¡®ä¿æ ¹ç»“ç‚¹æ˜¯é¦–ç»“ç‚¹</span></span><br><span class="line">    moveRootToFront(tab, root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘è½¬æ¢ä¸ºé“¾è¡¨</span></span><br><span class="line"><span class="comment"> * å½“çº¢é»‘æ ‘ç»“ç‚¹å‡å°‘åˆ°é“¾è¡¨è¿˜åŸé˜ˆå€¼ï¼ˆé»˜è®¤6ï¼‰æ—¶è§¦å‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> HashMap.<span class="function">Node&lt;K,V&gt; <span class="title">untreeify</span><span class="params">(HashMap&lt;K,V&gt; map)</span> </span>&#123;</span><br><span class="line">    HashMap.Node&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (HashMap.Node&lt;K,V&gt; q = <span class="keyword">this</span>; q != <span class="keyword">null</span>; q = q.next) &#123;</span><br><span class="line">        HashMap.Node&lt;K,V&gt; p = map.replacementNode(q, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (tl == <span class="keyword">null</span>)</span><br><span class="line">            hd = p;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            tl.next = p;</span><br><span class="line">        tl = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘æ’å…¥æ–°ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">putTreeVal</span><span class="params">(HashMap&lt;K,V&gt; map, HashMap.Node&lt;K,V&gt;[] tab,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="keyword">int</span> h, K k, V v)</span> </span>&#123;</span><br><span class="line">    Class&lt;?&gt; kc = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> searched = <span class="keyword">false</span>;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; root = (parent != <span class="keyword">null</span>) ? root() : <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; p = root;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> dir, ph; K pk;</span><br><span class="line">        <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">            dir = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">            dir = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((pk = p.key) == k || (k != <span class="keyword">null</span> &amp;&amp; k.equals(pk)))</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((kc == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                (kc = comparableClassFor(k)) == <span class="keyword">null</span>) ||</span><br><span class="line">                (dir = compareComparables(kc, k, pk)) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!searched) &#123;</span><br><span class="line">                HashMap.TreeNode&lt;K,V&gt; q, ch;</span><br><span class="line">                searched = <span class="keyword">true</span>;</span><br><span class="line">                <span class="comment">//æ’å…¥ç»“ç‚¹ä¸å½“å‰ç»“ç‚¹hashå€¼ç›¸ç­‰æ—¶ï¼ŒæŸ¥æ‰¾å·¦å­æ ‘æˆ–å³å­æ ‘ï¼Œè‹¥å·²åŒ…å«å¾…æ’å…¥ç»“ç‚¹åˆ™ç›´æ¥è¿”å›ç»“æœ</span></span><br><span class="line">                <span class="keyword">if</span> (((ch = p.left) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                        (q = ch.find(h, k, kc)) != <span class="keyword">null</span>) ||</span><br><span class="line">                        ((ch = p.right) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                                (q = ch.find(h, k, kc)) != <span class="keyword">null</span>))</span><br><span class="line">                    <span class="keyword">return</span> q;</span><br><span class="line">            &#125;</span><br><span class="line">            dir = tieBreakOrder(k, pk);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; xp = p;</span><br><span class="line">        <span class="comment">//è‹¥å·²æ¯”è¾ƒåˆ°å·¦å­æ ‘æˆ–å³å­æ ‘ä¸ºç©ºæ—¶è¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æ’å…¥è¯¥ç»“ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> ((p = (dir &lt;= <span class="number">0</span>) ? p.left : p.right) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            HashMap.Node&lt;K,V&gt; xpn = xp.next;</span><br><span class="line">            HashMap.TreeNode&lt;K,V&gt; x = map.newTreeNode(h, k, v, xpn);</span><br><span class="line">            <span class="keyword">if</span> (dir &lt;= <span class="number">0</span>)</span><br><span class="line">                xp.left = x;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                xp.right = x;</span><br><span class="line">            xp.next = x;</span><br><span class="line">            x.parent = x.prev = xp;</span><br><span class="line">            <span class="keyword">if</span> (xpn != <span class="keyword">null</span>)</span><br><span class="line">                ((HashMap.TreeNode&lt;K,V&gt;)xpn).prev = x;</span><br><span class="line">            moveRootToFront(tab, balanceInsertion(root, x));</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤çº¢é»‘æ ‘ç»“ç‚¹</span></span><br><span class="line"><span class="comment"> * å‘ƒï¼Œè¿™ä¸ªæ–¹æ³•å’Œå‰é¢çš„æ¯”èµ·æ¥å¤§åŒå°å¼‚ï¼Œä¸ç»†çœ‹äº†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeTreeNode</span><span class="params">(HashMap&lt;K,V&gt; map, HashMap.Node&lt;K,V&gt;[] tab,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> index = (n - <span class="number">1</span>) &amp; hash;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; first = (HashMap.TreeNode&lt;K,V&gt;)tab[index], root = first, rl;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; succ = (HashMap.TreeNode&lt;K,V&gt;)next, pred = prev;</span><br><span class="line">    <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">        tab[index] = first = succ;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        pred.next = succ;</span><br><span class="line">    <span class="keyword">if</span> (succ != <span class="keyword">null</span>)</span><br><span class="line">        succ.prev = pred;</span><br><span class="line">    <span class="keyword">if</span> (first == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (root.parent != <span class="keyword">null</span>)</span><br><span class="line">        root = root.root();</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span> || root.right == <span class="keyword">null</span> ||</span><br><span class="line">            (rl = root.left) == <span class="keyword">null</span> || rl.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//è‹¥åˆ é™¤ç»“ç‚¹åï¼Œè¾¾åˆ°é“¾è¡¨è¿˜åŸé˜ˆå€¼ï¼Œåˆ™è¿˜åŸä¸ºé“¾è¡¨</span></span><br><span class="line">        tab[index] = first.untreeify(map);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; p = <span class="keyword">this</span>, pl = left, pr = right, replacement;</span><br><span class="line">    <span class="keyword">if</span> (pl != <span class="keyword">null</span> &amp;&amp; pr != <span class="keyword">null</span>) &#123;</span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; s = pr, sl;</span><br><span class="line">        <span class="keyword">while</span> ((sl = s.left) != <span class="keyword">null</span>) <span class="comment">// find successor</span></span><br><span class="line">            s = sl;</span><br><span class="line">        <span class="keyword">boolean</span> c = s.red; s.red = p.red; p.red = c; <span class="comment">// swap colors</span></span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; sr = s.right;</span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; pp = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (s == pr) &#123; <span class="comment">// p was s's direct parent</span></span><br><span class="line">            p.parent = s;</span><br><span class="line">            s.right = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            HashMap.TreeNode&lt;K,V&gt; sp = s.parent;</span><br><span class="line">            <span class="keyword">if</span> ((p.parent = sp) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (s == sp.left)</span><br><span class="line">                    sp.left = p;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    sp.right = p;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((s.right = pr) != <span class="keyword">null</span>)</span><br><span class="line">                pr.parent = s;</span><br><span class="line">        &#125;</span><br><span class="line">        p.left = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> ((p.right = sr) != <span class="keyword">null</span>)</span><br><span class="line">            sr.parent = p;</span><br><span class="line">        <span class="keyword">if</span> ((s.left = pl) != <span class="keyword">null</span>)</span><br><span class="line">            pl.parent = s;</span><br><span class="line">        <span class="keyword">if</span> ((s.parent = pp) == <span class="keyword">null</span>)</span><br><span class="line">            root = s;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p == pp.left)</span><br><span class="line">            pp.left = s;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pp.right = s;</span><br><span class="line">        <span class="keyword">if</span> (sr != <span class="keyword">null</span>)</span><br><span class="line">            replacement = sr;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            replacement = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pl != <span class="keyword">null</span>)</span><br><span class="line">        replacement = pl;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pr != <span class="keyword">null</span>)</span><br><span class="line">        replacement = pr;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        replacement = p;</span><br><span class="line">    <span class="keyword">if</span> (replacement != p) &#123;</span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; pp = replacement.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (pp == <span class="keyword">null</span>)</span><br><span class="line">            root = replacement;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p == pp.left)</span><br><span class="line">            pp.left = replacement;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pp.right = replacement;</span><br><span class="line">        p.left = p.right = p.parent = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; r = p.red ? root : balanceDeletion(root, replacement);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (replacement == p) &#123;  <span class="comment">// detach</span></span><br><span class="line">        HashMap.TreeNode&lt;K,V&gt; pp = p.parent;</span><br><span class="line">        p.parent = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (pp != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p == pp.left)</span><br><span class="line">                pp.left = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p == pp.right)</span><br><span class="line">                pp.right = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (movable)</span><br><span class="line">        moveRootToFront(tab, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†çº¢é»‘æ ‘åˆ†ä¸ºä¸¤åŠ</span></span><br><span class="line"><span class="comment"> * æ‰©å®¹æ—¶ï¼Œä¼šå°†ä¸€ä¸ªæ¡¶ä¸­çš„çº¢é»‘æ ‘æ‹†åˆ†ä¸ºä¸¤ä¸ªï¼›è‹¥æ‹†åˆ†åçº¢é»‘æ ‘ä¸å¤Ÿå¤§ï¼Œä¼šè¢«è¿˜åŸä¸ºé“¾è¡¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(HashMap&lt;K,V&gt; map, HashMap.Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> index, <span class="keyword">int</span> bit)</span> </span>&#123;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; b = <span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">// Relink into lo and hi lists, preserving order</span></span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> lc = <span class="number">0</span>, hc = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; e = b, next; e != <span class="keyword">null</span>; e = next) &#123;</span><br><span class="line">        next = (HashMap.TreeNode&lt;K,V&gt;)e.next;</span><br><span class="line">        e.next = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> ((e.hash &amp; bit) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((e.prev = loTail) == <span class="keyword">null</span>)</span><br><span class="line">                loHead = e;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                loTail.next = e;</span><br><span class="line">            loTail = e;</span><br><span class="line">            ++lc;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((e.prev = hiTail) == <span class="keyword">null</span>)</span><br><span class="line">                hiHead = e;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                hiTail.next = e;</span><br><span class="line">            hiTail = e;</span><br><span class="line">            ++hc;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (loHead != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (lc &lt;= UNTREEIFY_THRESHOLD)</span><br><span class="line">            tab[index] = loHead.untreeify(map);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tab[index] = loHead;</span><br><span class="line">            <span class="keyword">if</span> (hiHead != <span class="keyword">null</span>) <span class="comment">// (else is already treeified)</span></span><br><span class="line">                loHead.treeify(tab);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (hiHead != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hc &lt;= UNTREEIFY_THRESHOLD)</span><br><span class="line">            tab[index + bit] = hiHead.untreeify(map);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tab[index + bit] = hiHead;</span><br><span class="line">            <span class="keyword">if</span> (loHead != <span class="keyword">null</span>)</span><br><span class="line">                hiHead.treeify(tab);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ------------------------------------------------------------ */</span></span><br><span class="line"><span class="comment">// Red-black tree methods, all adapted from CLR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘çš„å·¦æ—‹</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘ç›¸å…³çŸ¥è¯†å¾…æ·±å…¥å­¦ä¹ åè¿›ä¸€æ­¥æ¢è®¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">rotateLeft</span><span class="params">(HashMap.TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              HashMap.TreeNode&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; r, pp, rl;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span> &amp;&amp; (r = p.right) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((rl = p.right = r.left) != <span class="keyword">null</span>)</span><br><span class="line">            rl.parent = p;</span><br><span class="line">        <span class="keyword">if</span> ((pp = r.parent = p.parent) == <span class="keyword">null</span>)</span><br><span class="line">            (root = r).red = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pp.left == p)</span><br><span class="line">            pp.left = r;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pp.right = r;</span><br><span class="line">        r.left = p;</span><br><span class="line">        p.parent = r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çº¢é»‘æ ‘çš„å³æ—‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">rotateRight</span><span class="params">(HashMap.TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                               HashMap.TreeNode&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; l, pp, lr;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span> &amp;&amp; (l = p.left) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((lr = p.left = l.right) != <span class="keyword">null</span>)</span><br><span class="line">            lr.parent = p;</span><br><span class="line">        <span class="keyword">if</span> ((pp = l.parent = p.parent) == <span class="keyword">null</span>)</span><br><span class="line">            (root = l).red = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pp.right == p)</span><br><span class="line">            pp.right = l;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            pp.left = l;</span><br><span class="line">        l.right = p;</span><br><span class="line">        p.parent = l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥ç»“ç‚¹åè¿›è¡Œé‡å¹³è¡¡</span></span><br><span class="line"><span class="comment"> * è¿™éƒ¨åˆ†åªçœ‹æ‡‚ä»£ç äº†ï¼Œç®—æ³•æ¯”è¾ƒæ‡µï¼Œæœ‰æœºä¼šå†æ¢è®¨çº¢é»‘æ ‘ç®—æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">balanceInsertion</span><span class="params">(HashMap.TreeNode&lt;K,V&gt; root, HashMap.TreeNode&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å°†æ’å…¥çš„ç»“ç‚¹è®¾ä¸ºçº¢è‰²</span></span><br><span class="line">    x.red = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; xp, xpp, xppl, xppr;;) &#123;</span><br><span class="line">        <span class="comment">//xä¸ºæ ¹ç»“ç‚¹æ—¶ï¼Œè®¾ä¸ºé»‘è‰²ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> ((xp = x.parent) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//çˆ¶ç»“ç‚¹ä¸ºé»‘ä¸”ä¸ºæ ¹ç»“ç‚¹æ—¶ï¼Œç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!xp.red || (xpp = xp.parent) == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        <span class="comment">//çˆ¶ç»“ç‚¹ä¸ºç¥–çˆ¶ç»“ç‚¹çš„å·¦å­©å­ç»“ç‚¹æ—¶ï¼š</span></span><br><span class="line">        <span class="keyword">if</span> (xp == (xppl = xpp.left)) &#123;</span><br><span class="line">            <span class="comment">//ç¥–çˆ¶ç»“ç‚¹çš„å³å­©å­ç»“ç‚¹ä¸ºçº¢è‰²æ—¶ï¼Œå”å”ç»“ç‚¹å’Œçˆ¶ç»“ç‚¹ç½®é»‘ï¼Œç¥–çˆ¶ç»“ç‚¹ç½®çº¢ï¼Œè®¾ç½®å½“å‰ç»“ç‚¹ä¸ºç¥–çˆ¶ç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> ((xppr = xpp.right) != <span class="keyword">null</span> &amp;&amp; xppr.red) &#123;</span><br><span class="line">                xppr.red = <span class="keyword">false</span>;</span><br><span class="line">                xp.red = <span class="keyword">false</span>;</span><br><span class="line">                xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                x = xpp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//å¦åˆ™ï¼Œå¦‚æœå½“å‰ç»“ç‚¹ä¸ºçˆ¶ç»“ç‚¹çš„å³å­©å­ç»“ç‚¹ï¼Œè¿›è¡Œå·¦æ—‹</span></span><br><span class="line">                <span class="keyword">if</span> (x == xp.right) &#123;</span><br><span class="line">                    root = rotateLeft(root, x = xp);</span><br><span class="line">                    xpp = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.parent;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//å¦‚æœçˆ¶ç»“ç‚¹ä¸ä¸ºç©ºè®¾ä¸ºé»‘è‰²ï¼Œä¸”å¦‚æœç¥–çˆ¶ç»“ç‚¹ä¸ä¸ºç©ºåˆ™è®¾ä¸ºçº¢è‰²å¹¶è¿›è¡Œå³æ—‹</span></span><br><span class="line">                <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    xp.red = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (xpp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateRight(root, xpp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (xppl != <span class="keyword">null</span> &amp;&amp; xppl.red) &#123;</span><br><span class="line">                xppl.red = <span class="keyword">false</span>;</span><br><span class="line">                xp.red = <span class="keyword">false</span>;</span><br><span class="line">                xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                x = xpp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (x == xp.left) &#123;</span><br><span class="line">                    root = rotateRight(root, x = xp);</span><br><span class="line">                    xpp = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.parent;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    xp.red = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">if</span> (xpp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xpp.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateLeft(root, xpp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤ç»“ç‚¹åè¿›è¡Œé‡å¹³è¡¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; HashMap.<span class="function">TreeNode&lt;K,V&gt; <span class="title">balanceDeletion</span><span class="params">(HashMap.TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                   HashMap.TreeNode&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (HashMap.TreeNode&lt;K,V&gt; xp, xpl, xpr;;)  &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span> || x == root)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((xp = x.parent) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x.red) &#123;</span><br><span class="line">            x.red = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((xpl = xp.left) == x) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((xpr = xp.right) != <span class="keyword">null</span> &amp;&amp; xpr.red) &#123;</span><br><span class="line">                xpr.red = <span class="keyword">false</span>;</span><br><span class="line">                xp.red = <span class="keyword">true</span>;</span><br><span class="line">                root = rotateLeft(root, xp);</span><br><span class="line">                xpr = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (xpr == <span class="keyword">null</span>)</span><br><span class="line">                x = xp;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                HashMap.TreeNode&lt;K,V&gt; sl = xpr.left, sr = xpr.right;</span><br><span class="line">                <span class="keyword">if</span> ((sr == <span class="keyword">null</span> || !sr.red) &amp;&amp;</span><br><span class="line">                        (sl == <span class="keyword">null</span> || !sl.red)) &#123;</span><br><span class="line">                    xpr.red = <span class="keyword">true</span>;</span><br><span class="line">                    x = xp;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (sr == <span class="keyword">null</span> || !sr.red) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (sl != <span class="keyword">null</span>)</span><br><span class="line">                            sl.red = <span class="keyword">false</span>;</span><br><span class="line">                        xpr.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateRight(root, xpr);</span><br><span class="line">                        xpr = (xp = x.parent) == <span class="keyword">null</span> ?</span><br><span class="line">                                <span class="keyword">null</span> : xp.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xpr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xpr.red = (xp == <span class="keyword">null</span>) ? <span class="keyword">false</span> : xp.red;</span><br><span class="line">                        <span class="keyword">if</span> ((sr = xpr.right) != <span class="keyword">null</span>)</span><br><span class="line">                            sr.red = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xp.red = <span class="keyword">false</span>;</span><br><span class="line">                        root = rotateLeft(root, xp);</span><br><span class="line">                    &#125;</span><br><span class="line">                    x = root;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="comment">// symmetric</span></span><br><span class="line">            <span class="keyword">if</span> (xpl != <span class="keyword">null</span> &amp;&amp; xpl.red) &#123;</span><br><span class="line">                xpl.red = <span class="keyword">false</span>;</span><br><span class="line">                xp.red = <span class="keyword">true</span>;</span><br><span class="line">                root = rotateRight(root, xp);</span><br><span class="line">                xpl = (xp = x.parent) == <span class="keyword">null</span> ? <span class="keyword">null</span> : xp.left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (xpl == <span class="keyword">null</span>)</span><br><span class="line">                x = xp;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                HashMap.TreeNode&lt;K,V&gt; sl = xpl.left, sr = xpl.right;</span><br><span class="line">                <span class="keyword">if</span> ((sl == <span class="keyword">null</span> || !sl.red) &amp;&amp;</span><br><span class="line">                        (sr == <span class="keyword">null</span> || !sr.red)) &#123;</span><br><span class="line">                    xpl.red = <span class="keyword">true</span>;</span><br><span class="line">                    x = xp;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (sl == <span class="keyword">null</span> || !sl.red) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (sr != <span class="keyword">null</span>)</span><br><span class="line">                            sr.red = <span class="keyword">false</span>;</span><br><span class="line">                        xpl.red = <span class="keyword">true</span>;</span><br><span class="line">                        root = rotateLeft(root, xpl);</span><br><span class="line">                        xpl = (xp = x.parent) == <span class="keyword">null</span> ?</span><br><span class="line">                                <span class="keyword">null</span> : xp.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xpl != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xpl.red = (xp == <span class="keyword">null</span>) ? <span class="keyword">false</span> : xp.red;</span><br><span class="line">                        <span class="keyword">if</span> ((sl = xpl.left) != <span class="keyword">null</span>)</span><br><span class="line">                            sl.red = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (xp != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        xp.red = <span class="keyword">false</span>;</span><br><span class="line">                        root = rotateRight(root, xp);</span><br><span class="line">                    &#125;</span><br><span class="line">                    x = root;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ£€æŸ¥çº¢é»‘æ ‘ç»“æ„æ˜¯å¦æ­£å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> &lt;K,V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">checkInvariants</span><span class="params">(HashMap.TreeNode&lt;K,V&gt; t)</span> </span>&#123;</span><br><span class="line">    HashMap.TreeNode&lt;K,V&gt; tp = t.parent, tl = t.left, tr = t.right,</span><br><span class="line">            tb = t.prev, tn = (HashMap.TreeNode&lt;K,V&gt;)t.next;</span><br><span class="line">    <span class="keyword">if</span> (tb != <span class="keyword">null</span> &amp;&amp; tb.next != t)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (tn != <span class="keyword">null</span> &amp;&amp; tn.prev != t)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (tp != <span class="keyword">null</span> &amp;&amp; t != tp.left &amp;&amp; t != tp.right)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (tl != <span class="keyword">null</span> &amp;&amp; (tl.parent != t || tl.hash &gt; t.hash))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (tr != <span class="keyword">null</span> &amp;&amp; (tr.parent != t || tr.hash &lt; t.hash))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (t.red &amp;&amp; tl != <span class="keyword">null</span> &amp;&amp; tl.red &amp;&amp; tr != <span class="keyword">null</span> &amp;&amp; tr.red)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (tl != <span class="keyword">null</span> &amp;&amp; !checkInvariants(tl))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (tr != <span class="keyword">null</span> &amp;&amp; !checkInvariants(tr))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/2018/09/24/Java-8-HashMap-ä¸Š-â€”â€”-çº¢é»‘æ ‘/IMG_1756.GIF">
<p>Java8çš„HashMapè§£è¯»æš‚å‘Šä¸€æ®µè½ï¼Œä¸‹æœŸç»§ç»­æ¢è®¨å…¶ä»–ç‰¹æ€§ï¼Œå¸Œæœ›ä¸è¦å¤ªä¹…ğŸ˜‚</p>
<p><a href="https://y.qq.com/n/yqq/song/004dbfuf1jEjpI.html#stat=y_new.index.new_song.songname" target="_blank" rel="noopener">https://y.qq.com/n/yqq/song/004dbfuf1jEjpI.html#stat=y_new.index.new_song.songname</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/09/24/Java-8-HashMapï¼ˆä¸‹ï¼‰â€”â€” compute/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/24/Java-8-HashMapï¼ˆä¸‹ï¼‰â€”â€” compute/" itemprop="url">Java 8 HashMap(ä¸‹)â€”â€” compute</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-09-24T00:19:04+08:00">
                2018-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2018/09/24/Java-8-HashMapï¼ˆä¸‹ï¼‰â€”â€”%20compute/IMG_0011.JPG" title="æ•…ä¹¡çš„æœˆ">
<p><em>æ¨èé˜…è¯»æ—¶é—´ï¼š5åˆ†é’Ÿ</em></p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>æœ¬ç¯‡æ¥ä¸Šç¯‡ <a href="https://jasonsonghoho.github.io/2018/09/24/Java-8-HashMap-%E4%B8%8A-%E2%80%94%E2%80%94-%E7%BA%A2%E9%BB%91%E6%A0%91/">Java 8 HashMap (ä¸Š)â€”â€” çº¢é»‘æ ‘</a>ï¼Œ<br>ç»§ç»­æ¢è®¨ Java8 çš„HashMap çš„æ–°ç‰¹æ€§ã€‚å†…å®¹ä¸å¤šï¼Œé‡ç‚¹ä»‹ç» compute æ–¹æ³•ã€‚</p>
<h3 id="compute"><a href="#compute" class="headerlink" title="compute"></a>compute</h3><p>compute æ–¹æ³•ä¸»è¦ç”¨æ¥å°†ä¸€ä¸ªå¤æ‚è®¡ç®—çš„ç»“æœä½œä¸ºå€¼èµ‹ç»™æŒ‡å®šçš„é”®ã€‚key æŒ‡å¾…ä¿®æ”¹æˆ–æ’å…¥çš„é”®ï¼ŒremappingFunction æ˜¯ä¸€ä¸ª BiFunction å¯¹è±¡ã€‚<br>BiFunction æ˜¯æŒ‡ä¸€ä¸ª äºŒå…ƒï¼ˆbinaryï¼‰å‡½æ•°ï¼›å®šä¹‰æ—¶ï¼ŒæŒ‡å®šä¸¤ä¸ªå…¥å‚å­—æ®µç±»å‹å’Œä¸€ä¸ªç»“æœå­—æ®µç±»å‹ã€‚é€šè¿‡å®ç° apply æ–¹æ³•æ¥è‡ªå®šä¹‰è®¡ç®—é€»è¾‘ã€‚</p>
<p>BiFunction éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BiFunction</span>&lt;<span class="title">T</span>, <span class="title">U</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Applies this function to the given arguments.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the first function argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> u the second function argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the function result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t, U u)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>compute æ–¹æ³•æºç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">compute</span><span class="params">(K key, BiFunction&lt;? <span class="keyword">super</span> K, ? <span class="keyword">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (remappingFunction == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="keyword">int</span> binCount = <span class="number">0</span>;</span><br><span class="line">    TreeNode&lt;K,V&gt; t = <span class="keyword">null</span>;</span><br><span class="line">    Node&lt;K,V&gt; old = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (size &gt; threshold || (tab = table) == <span class="keyword">null</span> ||</span><br><span class="line">        (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">//æ ¹æ® key å€¼ï¼Œæ‰¾åˆ°å¯¹åº”çš„ æ—§å€¼</span></span><br><span class="line">    <span class="keyword">if</span> ((first = tab[i = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            old = (t = (TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e = first; K k;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                    old = e;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ++binCount;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    V oldValue = (old == <span class="keyword">null</span>) ? <span class="keyword">null</span> : old.value;</span><br><span class="line">    <span class="comment">//è®¡ç®—å‡ºæ–°å€¼</span></span><br><span class="line">    V v = remappingFunction.apply(key, oldValue);</span><br><span class="line">    <span class="keyword">if</span> (old != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v != <span class="keyword">null</span>) &#123;</span><br><span class="line">            old.value = v;</span><br><span class="line">            afterNodeAccess(old);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="comment">//å¦‚æœæ–°å€¼ä¸º nullï¼Œåˆ æ‰è¿™ä¸ª Node</span></span><br><span class="line">            removeNode(hash, key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¦‚æœæ–°å€¼ä¸ä¸º nullï¼Œæ›¿æ¢è¿™ä¸ª Node</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (v != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (t != <span class="keyword">null</span>)</span><br><span class="line">            t.putTreeVal(<span class="keyword">this</span>, tab, hash, key, v);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tab[i] = newNode(hash, key, v, first);</span><br><span class="line">            <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>)</span><br><span class="line">                treeifyBin(tab, hash);</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        ++size;</span><br><span class="line">        afterNodeInsertion(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>computeIfAbsentã€computeIfPresent æ–¹æ³•ä¸ compute ç±»ä¼¼ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“ç›¸åº”é”®çš„å€¼ç¼ºå¸­ã€å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œ compute æ–¹æ³•ã€‚<br>æºç ä¸ compute åŸºæœ¬ä¸€è‡´ï¼Œä¸èµ˜è¿°ã€‚</p>
<p>demo å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, String&gt; hashMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">    hashMap.put(<span class="string">"k1"</span>, <span class="string">"v1"</span>);</span><br><span class="line">    hashMap.put(<span class="string">"k2"</span>, <span class="string">"v2"</span>);</span><br><span class="line">    hashMap.put(<span class="string">"k3"</span>, <span class="string">"v3"</span>);</span><br><span class="line">    Function&lt;String, String&gt; function = <span class="keyword">new</span> Function&lt;String, String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"test_"</span> + s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    BiFunction&lt;String, String, String&gt; biFunction = <span class="keyword">new</span> BiFunction&lt;String, String, String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(String s, String s2)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"test_"</span> + s + <span class="string">"_"</span> + s2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    hashMap.compute(<span class="string">"k1"</span>, biFunction);<span class="comment">//ç”Ÿæ•ˆ</span></span><br><span class="line">    hashMap.compute(<span class="string">"k11"</span>, biFunction);<span class="comment">//ç”Ÿæ•ˆ</span></span><br><span class="line">    hashMap.computeIfAbsent(<span class="string">"k2"</span>, function);<span class="comment">//ä¸ç”Ÿæ•ˆ</span></span><br><span class="line">    hashMap.computeIfAbsent(<span class="string">"k21"</span>, function);<span class="comment">//ç”Ÿæ•ˆ</span></span><br><span class="line">    hashMap.computeIfPresent(<span class="string">"k3"</span>, biFunction);<span class="comment">//ç”Ÿæ•ˆ</span></span><br><span class="line">    hashMap.computeIfPresent(<span class="string">"k31"</span>, biFunction);<span class="comment">//ä¸ç”Ÿæ•ˆ</span></span><br><span class="line">    System.out.println(hashMap);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;k1=test_k1_v1, k2=v2, k3=test_k3_v3, k11=test_k11_null, k21=test_k21&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><p>merge æ–¹æ³•æ˜¯æ ¹æ®æ—§å€¼è¿›è¡Œè®¡ç®—ï¼Œä¿®æ”¹ç›¸åº” Nodeã€‚ä¸ compute ç»“æ„ç›¸ä¼¼ï¼Œä¸è¿‡ BiFunction å…¥å‚ä¸º oldValue,newValueã€‚<br>æºç ä¸ compute åŸºæœ¬ä¸€è‡´ï¼Œä¸èµ˜è¿°ã€‚</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å…¶ä»–æ–°å¢çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">getOrDefault</span><span class="params">(Object key, V defaultValue)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? defaultValue : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">putIfAbsent</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object key, Object value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> removeNode(hash(key), key, value, <span class="keyword">true</span>, <span class="keyword">true</span>) != <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replace</span><span class="params">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e; V v;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">        ((v = e.value) == oldValue || (v != <span class="keyword">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class="line">        e.value = newValue;</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">replace</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        V oldValue = e.value;</span><br><span class="line">        e.value = value;</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>getOrDefault æ–¹æ³•æ ¹æ® key è·å–ç›¸åº”çš„å€¼ï¼Œå¦‚æœä¸º nullï¼Œåˆ™è¿”å›è®¾ç½®çš„é»˜è®¤å€¼ã€‚</li>
<li>putIfAbsent æ–¹æ³•ä¼šåœ¨ æŒ‡å®šçš„ key ä¸å­˜åœ¨æ—¶ï¼Œæ’å…¥ç›¸åº”çš„å€¼ã€‚</li>
<li>remove(Object key, Object value) æ–¹æ³•ä¼šæ ¹æ® key å’Œ value è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœ ç›¸åº” key çš„å€¼ä¸ä¸ºè¯¥ valueï¼Œåˆ™ä¸æ‰§è¡Œåˆ é™¤å¹¶è¿”å› falseã€‚</li>
<li>replace(K key, V oldValue, V newValue) ä¸ replace(K key, V value) éƒ½æ˜¯æ›¿æ¢å€¼çš„æ“ä½œï¼Œå…·ä½“åŒºåˆ«ä¸ä¸Šè¿°æ–¹æ³•ç±»ä¼¼ã€‚</li>
</ol>
<h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>HashMapå†æ—¶ä¸€ä¸ªåŠæœˆï¼Œç»ˆäºå‘Šä¸€æ®µè½äº†ğŸ˜‚ã€‚</p>
<p>ç”±äºåœ¨æºç åˆ†æç³»åˆ—å«æœ‰å¤§é‡ä»£ç ï¼Œæ”¾åœ¨å…¬ä¼—å·ä¸Šä¸æ–¹ä¾¿é˜…è¯»ï¼Œåç»­å†™çš„è¯ä¼šå‘åœ¨åšå®¢ä¸Šã€‚æœ‰å…´è¶£çš„æ¬¢è¿è®¿é—® <a href="http://jasonsonghoho.github.io">http://jasonsonghoho.github.io</a> ã€‚</p>
<hr>
<img src="/2018/09/24/Java-8-HashMapï¼ˆä¸‹ï¼‰â€”â€”%20compute/IMG_0007.JPG">
<p><em>â€œä½ ä¸çŸ¥<br>è¿™é£é›ªä¸€ç¨‹<br>æœ‰å¤ªå¤šä¸æ˜“â€</em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/08/18/Java-7-HashMap-æºç è§£è¯»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/18/Java-7-HashMap-æºç è§£è¯»/" itemprop="url">Java 7 HashMap æºç è§£è¯»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-18T10:31:46+08:00">
                2018-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è§é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/nHk9jKapNVVkBDnKChgK0Q" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/nHk9jKapNVVkBDnKChgK0Q</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/06/24/Reactå¿«é€Ÿå…¥é—¨/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/24/Reactå¿«é€Ÿå…¥é—¨/" itemprop="url">Reactå¿«é€Ÿå…¥é—¨</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-24T10:34:27+08:00">
                2018-06-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/å‰ç«¯/" itemprop="url" rel="index">
                    <span itemprop="name">å‰ç«¯</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è§é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/fDXQe_QCBN4q6zfzKQr1jQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/fDXQe_QCBN4q6zfzKQr1jQ</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/06/05/åŠ¨ç‰©å›­ç®¡ç†å‘˜â€”â€”ZooKeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/05/åŠ¨ç‰©å›­ç®¡ç†å‘˜â€”â€”ZooKeeper/" itemprop="url">åŠ¨ç‰©å›­ç®¡ç†å‘˜â€”â€”ZooKeeper</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-06-05T10:35:00+08:00">
                2018-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ä¸­é—´ä»¶/" itemprop="url" rel="index">
                    <span itemprop="name">ä¸­é—´ä»¶</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è§é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/hnfWq1sHD8qxKoXHKwJhiw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/hnfWq1sHD8qxKoXHKwJhiw</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/05/27/MySQLç©¶ç«Ÿå¦‚ä½•è§£å†³â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€çš„/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/27/MySQLç©¶ç«Ÿå¦‚ä½•è§£å†³â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€çš„/" itemprop="url">MySQLç©¶ç«Ÿå¦‚ä½•è§£å†³â€œä¸å¯é‡å¤è¯»â€å’Œâ€œå¹»è¯»â€çš„</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-27T00:35:44+08:00">
                2018-05-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ•°æ®åº“/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è§é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/Ej3coEuouPqbzkL0-J8tIQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Ej3coEuouPqbzkL0-J8tIQ</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/05/21/180521/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/21/180521/" itemprop="url">æˆ‘ä»¬ä¸ºæå‡ Cassandra è¯»æ€§èƒ½åšäº†å“ªäº›åŠªåŠ›ï¼Ÿ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-21T22:08:41+08:00">
                2018-05-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ•°æ®åº“/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ç›®å½•-Table-of-Contents"><a href="#ç›®å½•-Table-of-Contents" class="headerlink" title=" ç›®å½• (Table of Contents)"></a> <strong>ç›®å½• (Table of Contents)</strong></h2><ul>
<li>å…³äºCassandra</li>
<li>æå‡è¯»æ€§èƒ½</li>
</ul>
<h2 id="å…³äºCassandra"><a href="#å…³äºCassandra" class="headerlink" title="å…³äºCassandra"></a>å…³äºCassandra</h2><p>Apache Cassandraæ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„é«˜æ€§èƒ½åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œ<br>ç”¨äºå¤„ç†å¤§é‡å¸¸è§„æœåŠ¡å™¨ä¸Šçš„å¤§é‡æ•°æ®ï¼Œæä¾›é«˜å¯ç”¨æ€§ï¼Œæ— å•ç‚¹æ•…éšœã€‚å®ƒæ˜¯ä¸€ç§NoSQLç±»å‹çš„æ•°æ®åº“ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å›½å¤–æƒå¨æœºæ„<a href="https://db-engines.com/en/ranking" target="_blank" rel="noopener">DB-Engines</a>æœ€è¿‘çš„æ•°æ®åº“å…¨çƒæµè¡Œç¨‹åº¦æ’åï¼š</p>
<img src="/2018/05/21/180521/database_rank.png" title="æ•°æ®åº“æ’å">
<p>å¯ä»¥çœ‹å‡ºï¼ŒCassandra æ˜¯æ’åå‰åä¸­å››ä¸ªä»…æœ‰çš„NoSQLæ•°æ®åº“ä¹‹ä¸€ã€‚Cassandraåœ¨å›½å¤–è¿™æ ·å—æ¬¢è¿ï¼Œå…¶æ€§èƒ½å¯æƒ³è€ŒçŸ¥ä¸ä¼šå·®ï¼Œ<br>ä½†æ˜¯åœ¨å›½å†…è²Œä¼¼è¿˜æ²¡æœ‰å¤šå°‘å…¬å¸ä½¿ç”¨ï¼Œä¸”å›½å†…å…³äº Cassandraæ–¹é¢çš„èµ„æ–™è¾ƒå°‘ã€‚</p>
<h2 id="æå‡è¯»æ€§èƒ½"><a href="#æå‡è¯»æ€§èƒ½" class="headerlink" title="æå‡è¯»æ€§èƒ½"></a>æå‡è¯»æ€§èƒ½</h2><p>Cassandra åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ç”¨æ¥å­˜å‚¨æ—¶åºæ•°æ®ï¼Œç»è¿‡æµ‹è¯•ï¼Œåœ¨ä¸‰å°4æ ¸16Gçš„è™šæ‹Ÿæœºä¸Šï¼Œ<br>æŒ‡æ ‡æ•°æ®çš„å†™å…¥TPSå¯ä»¥è¾¾åˆ°6.5W/sï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚<br>ä½†æ˜¯è¯»å–æ€§èƒ½å¯èƒ½å°±ä¼šå·®å¾ˆå¤šï¼Œå› ä¸ºæ•°æ®æŸ¥è¯¢é€Ÿåº¦è·Ÿæ¯æ¬¡æŸ¥è¯¢çš„æ•°æ®é‡å…³ç³»æ¯”è¾ƒå¤§ï¼Œæ­¤å¤„ä¹Ÿä¸å¥½å®šä¹‰TPSã€‚<br>äº§å“æŸ¥è¯¢ä¸€å‘¨ä»¥ä¸Šçš„æŒ‡æ ‡æ•°æ®æ—¶ï¼Œç»å¸¸ä¼šå‡ºç°åŠ è½½ç¼“æ…¢ï¼Œç”šè‡³æŸ¥è¯¢è¶…æ—¶ã€‚ä¸ºäº†æ”¹å–„æŸ¥è¯¢çŠ¶å†µï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸å°‘åŠªåŠ›ã€‚</p>
<p>æ­¤å¤„ä¸è®¨è®ºçºµå‘æ‰©å±•å’Œæ¨ªå‘æ‰©å±•å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚</p>
<h3 id="1-åŠ å¿«å¢“ç¢‘å›æ”¶ç”šè‡³å»é™¤å¢“ç¢‘"><a href="#1-åŠ å¿«å¢“ç¢‘å›æ”¶ç”šè‡³å»é™¤å¢“ç¢‘" class="headerlink" title="1. åŠ å¿«å¢“ç¢‘å›æ”¶ç”šè‡³å»é™¤å¢“ç¢‘"></a>1. åŠ å¿«å¢“ç¢‘å›æ”¶ç”šè‡³å»é™¤å¢“ç¢‘</h3><p>åœ¨Cassandraä¸­ï¼Œå½“ä½ åˆ é™¤ä¸€æ¡æ•°æ®æ—¶ï¼Œå…¶å®æ˜¯ç»™è¿™æ¡æ•°æ®è¿›è¡Œupdateï¼Œç»™å®ƒupdateä¸Šä¸€ä¸ªæ ‡è¯†ï¼Œå°±æ˜¯ä¸€ä¸ªå¢“ç¢‘æ ‡è¯†ã€‚<br> å½“Cassandraé›†ç¾¤åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥åˆ é™¤ä¿¡æ¯çš„æ—¶å€™ï¼Œä¹Ÿä¼šç”¨åˆ°Tombstones(å¢“ç¢‘)ï¼Œå¯ä»¥è¯´å¢“ç¢‘æ˜¯ä¸€ç§å…è®¸Cassandraå¿«é€Ÿå†™å…¥çš„æœºåˆ¶ã€‚</p>
<p>å…³äºå¢“ç¢‘çš„æ›´å¤šæ¶ˆæ¯ï¼Œå¯å‚è€ƒ <a href="https://docs.datastax.com/en/Cassandra/3.0/Cassandra/dml/dmlHowDataMaintain.html" target="_blank" rel="noopener">Cassandra æ•°æ®ç»´æŠ¤å®˜æ–¹æ–‡æ¡£</a></p>
<p>å¯ä»¥è¿™æ ·ç†è§£ï¼Œå¤§é‡çš„å¢“ç¢‘æ•°æ®ä¼šä½¿æŸ¥è¯¢æ—¶æœç´¢çš„æ•°æ®é‡å˜å¤§ï¼Œç›´æ¥å½±å“æŸ¥è¯¢æ—¶çš„æ•ˆç‡ã€‚<br>æ‰€ä»¥ï¼Œä¸ºäº†æ¶ˆé™¤è¿™ç§å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥åŠ å¿«å¢“ç¢‘æ•°æ®çš„å›æ”¶ï¼Œé¿å…äº§ç”Ÿå¤§é‡çš„å¢“ç¢‘æ•°æ®ã€‚<br>ç”šè‡³ï¼Œå½“æˆ‘ä»¬åœ¨å†™å…¥æ—¶ï¼Œè‹¥å†™å…¥ä¸€è‡´æ€§çš„å€¼ä¸å‰¯æœ¬å› å­æ•°é‡ç›¸ç­‰æ—¶ï¼Œå¯ä»¥ä¸äº§ç”Ÿå¢“ç¢‘æ•°æ®ï¼Œç›´æ¥åˆ æ‰è¯¥æ— æ•ˆæ•°æ®ã€‚<br>å…·ä½“å¯é€šè¿‡ è°ƒæ•´ table ä¸­ gc_grace_seconds å‚æ•°æ¥å®ç°ï¼Œé»˜è®¤ä¸º 864000ï¼ˆ10å¤©ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ä¸º 86400ï¼ˆ1å¤©ï¼‰æˆ–è€…0ï¼ˆç›´æ¥åˆ é™¤ï¼‰ã€‚</p>
<h3 id="2-é™ä½read-repair-çš„å‡ ç‡"><a href="#2-é™ä½read-repair-çš„å‡ ç‡" class="headerlink" title="2. é™ä½read repair çš„å‡ ç‡"></a>2. é™ä½read repair çš„å‡ ç‡</h3><p>æ¯ä¸€æ¬¡è¯»æ“ä½œï¼ŒCassandraéƒ½ä¼šåœ¨åå°è¿›è¡Œread repairæ“ä½œã€‚<br>å¦‚æœåªè¦æ±‚è¯»ä¸€ä¸ªèŠ‚ç‚¹æ•°æ®ï¼ŒCassandraåœ¨è¯»åˆ°ä¸€ä¸ªèŠ‚ç‚¹åï¼Œå°±å°†ç»“æœè¿”å›å®¢æˆ·ç«¯ï¼Œ<br>ç„¶åç”¨read repairå¯¹å…¶ä»–çš„replicasè¿›è¡ŒåŒæ­¥ï¼ˆæ ¹æ®timestampï¼‰ã€‚<br>å¦‚æœè¦æ±‚è¯»å¤šä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆCassandraå°±è¯»å¤šä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ ¹æ®timestampè¿›è¡Œæ¯”è¾ƒï¼Œè¿”å›å®¢æˆ·ç«¯æœ€æ–°çš„æ•°æ®ï¼Œ<br>ç„¶åå†è°ƒç”¨read repairå¯¹å…¶ä»–èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ã€‚<br>Read repairåœ¨åå°çš„æ“ä½œï¼Œä¼šå ç”¨ä¸€å®šçš„CPUå’ŒI/O,æ‰€ä»¥å½±å“è¯»æ€§èƒ½ã€‚<br>æˆ‘ä»¬å¯ä»¥é™ä½read repair çš„å‡ ç‡ï¼Œä»¥æé«˜è¯»å–æ€§èƒ½ã€‚</p>
<p>é€šè¿‡ä¿®æ”¹ table ä¸­ read_repair_chanceï¼ˆå–å€¼èŒƒå›´ 0-1ï¼‰å‚æ•°æ¥è®¾ç½®read repair çš„å‡ ç‡ï¼Œå»ºè®®è®¾ä¸º 0.1ã€‚</p>
<h3 id="3-æŒ‡æ ‡æ•°æ®é¢„èšåˆ"><a href="#3-æŒ‡æ ‡æ•°æ®é¢„èšåˆ" class="headerlink" title="3. æŒ‡æ ‡æ•°æ®é¢„èšåˆ"></a>3. æŒ‡æ ‡æ•°æ®é¢„èšåˆ</h3><p>æ€è·¯ï¼šæˆ‘ä»¬å­˜åœ¨æ•°æ®åº“ä¸­çš„æŒ‡æ ‡æ•°æ®ï¼Œè¯»å–æ—¶ä¼šå°†æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®è¿›è¡Œèšåˆã€‚<br>å¦‚æœæå‰å°†æ•°æ®æŒ‰åŸºæœ¬æ—¶é—´æ®µæå‰èšåˆä¸ºä¸€ä¸ªå€¼ï¼Œè¯»å–æ—¶ï¼Œåªè¯»å–æ—¶é—´èŒƒå›´å†…çš„æ—¶é—´æ®µçš„æ±‡èšç»“æœï¼Œå°†å¤§å¤§å‡å°‘æŸ¥è¯¢è€—æ—¶ã€‚</p>
<h3 id="4-åˆç†éƒ¨ç½²äº§å“"><a href="#4-åˆç†éƒ¨ç½²äº§å“" class="headerlink" title="4. åˆç†éƒ¨ç½²äº§å“"></a>4. åˆç†éƒ¨ç½²äº§å“</h3><p>å…¬å¸çš„å…¶ä»–äº§å“ä½¿ç”¨äº†mongoDBï¼Œçº¿ä¸Šç¯å¢ƒä¸­å‘ç°ï¼Œè¿™ä¸¤ä¸ªNoSQLæ•°æ®åº“éƒ¨ç½²åœ¨ä¸€èµ·æ—¶ä¼šç›¸äº’äº‰å¤ºå†…å­˜èµ„æºï¼Œ<br>ååˆ†å½±å“æ€§èƒ½ï¼Œå› æ­¤æœ€å¥½å°†è¿™ä¸¤ä¸ªæ•°æ®åº“åˆ†å¼€éƒ¨ç½²ã€‚</p>
<h3 id="5-è®¾ç½®åˆç†çš„å †å†…å­˜å¤§å°å’ŒGCç­–ç•¥"><a href="#5-è®¾ç½®åˆç†çš„å †å†…å­˜å¤§å°å’ŒGCç­–ç•¥" class="headerlink" title="5. è®¾ç½®åˆç†çš„å †å†…å­˜å¤§å°å’ŒGCç­–ç•¥"></a>5. è®¾ç½®åˆç†çš„å †å†…å­˜å¤§å°å’ŒGCç­–ç•¥</h3><p>å †å†…å­˜è®¾ç½®çš„å¤ªå°ï¼Œå°†å¯¼è‡´é¢‘ç¹GCç”šè‡³OOMï¼Œè®¾ç½®çš„å¤ªå¤§åŒæ ·ä¹Ÿä¸å¥½ã€‚å¯å‚è€ƒå®˜æ–¹çš„å…¬å¼:<br><code>MAX_HEAP_SIZE=max(min(1/2 ram, 1024MB), min(1/4 ram, 8GB)</code></p>
<p>å…³äºGCç­–ç•¥ï¼Œå®˜æ–¹çš„å»ºè®®æ˜¯ï¼šå°äº16Gï¼Œç”¨CMSæ”¶é›†å™¨ï¼›16-64Gï¼Œç”¨G1æ”¶é›†å™¨ã€‚</p>
<h3 id="6-è®¾ç½®åˆç†çš„å‹å¼ç­–ç•¥"><a href="#6-è®¾ç½®åˆç†çš„å‹å¼ç­–ç•¥" class="headerlink" title="6. è®¾ç½®åˆç†çš„å‹å¼ç­–ç•¥"></a>6. è®¾ç½®åˆç†çš„å‹å¼ç­–ç•¥</h3><p>Cassandra å°†è½åˆ°ç£ç›˜çš„æ•°æ®å­˜æ”¾åœ¨SStableä¸­ï¼Œå‹å®æ˜¯å°†å¤šä¸ªSSTable æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªçš„è¿‡ç¨‹ã€‚åˆå¹¶åå°†å‡å°‘é‡å¤çš„æ•°æ®ï¼Œä½¿æ•°æ®æ›´ç´§å‡‘ã€‚<br>Cassandra æœ‰å¤šç§è§¦å‘å‹å®çš„ç­–ç•¥ï¼Œé€‰ä¸€ä¸ªé€‚åˆçš„å‹å®ç­–ç•¥ï¼Œå¯ä»¥æ›´å¥½åœ°å‹å®æ•°æ®ã€‚<br>æ¯”å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„Kairosdbå»ºè®®é‡‡ç”¨ DateTieredCompactionStrategy (<a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/dml/dmlHowDataMaintain.html#dmlHowDataMaintain__dtcs-compaction" target="_blank" rel="noopener">DTCS</a>))å‹å®ç­–ç•¥ã€‚</p>
<h3 id="7-å¯ç”¨-row-cache"><a href="#7-å¯ç”¨-row-cache" class="headerlink" title="7. å¯ç”¨ row cache"></a>7. å¯ç”¨ row cache</h3><p>row cache æŠŠæ•´ä¸ªrow çš„å†…å®¹éƒ½æ”¾åœ¨å†…å­˜ä¸­ã€‚<br>é€‚åˆçš„æƒ…å†µæ˜¯ï¼Œæœ‰ä¸€å°éƒ¨åˆ†hot dataæ˜¯ç»å¸¸åé—®çš„ï¼Œæˆ–è€…è¦è¿”å›æ•´ä¸ªcolumns.åœ¨ä½¿ç”¨row cacheæ—¶ï¼Œç”¨æ³¨æ„å®ƒå¯¹å†…å­˜çš„å½±å“ã€‚<br>å¯å‚è€ƒ Cassandra çš„<a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/operations/opsConfiguringCaches.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>è®¾ç½®row cacheã€‚</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>å®‰åˆ©ä¸€ä¸ªå…¥é—¨Cassandra çš„å¥½åšå®¢ï¼š<a href="http://teddymaef.github.io/learnCassandra/cn/" target="_blank" rel="noopener">learn Cassandra</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/05/20/Linuxä¸­çš„topå‘½ä»¤è¯¦è§£/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/20/Linuxä¸­çš„topå‘½ä»¤è¯¦è§£/" itemprop="url">Linuxä¸­çš„topå‘½ä»¤è¯¦è§£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-20T10:41:23+08:00">
                2018-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è§é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/xyYn6xaahQ4hv1y9MM-7JA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/xyYn6xaahQ4hv1y9MM-7JA</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonsonghoho.github.io/2018/05/20/Linux-çš„-Cacheã€Bufferã€MemAvailableã€Swapç®€ä»‹/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jason song">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jason's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/20/Linux-çš„-Cacheã€Bufferã€MemAvailableã€Swapç®€ä»‹/" itemprop="url">Linux çš„ Cacheã€Bufferã€MemAvailableã€Swapç®€ä»‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-05-20T10:40:08+08:00">
                2018-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è§é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/59oH1hMMXy6YC618gZkm1g" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/59oH1hMMXy6YC618gZkm1g</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="jason song" />
            
              <p class="site-author-name" itemprop="name">jason song</p>
              <p class="site-description motion-element" itemprop="description">åˆ›é€ ç¾å¥½ï¼</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://jm.taobao.org/" title="é˜¿é‡Œä¸­é—´ä»¶BLOG" target="_blank">é˜¿é‡Œä¸­é—´ä»¶BLOG</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jason song</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  














  





  

  

  

  
  

  

  

  

</body>
</html>
